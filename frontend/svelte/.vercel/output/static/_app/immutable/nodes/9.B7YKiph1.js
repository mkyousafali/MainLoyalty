import"../chunks/DsnmJJEf.js";import"../chunks/69_IOA4Y.js";import{o as tt}from"../chunks/Y1pQyyvi.js";import{l as at,q as Y,r as st,m as x,C as it,t as I,x as O,a as e,n as b,o as lt,y as z,w as i,v as a,B as h,u,s as r,z as t,E as j,G as ot}from"../chunks/Ck91ypkQ.js";import{i as M}from"../chunks/RujGBxXx.js";import{e as rt}from"../chunks/D775oJua.js";import{a as nt,r as Q,s as vt}from"../chunks/DvH4tfbe.js";import{s as Ne}from"../chunks/B38bOHRo.js";import{a as be,c as ct}from"../chunks/C4HntxLm.js";import{i as dt}from"../chunks/6tn_K0LM.js";import"../chunks/qrUVQqOk.js";import{s as ae,T as se}from"../chunks/CIOq__Tp.js";var mt=x('<div class="date-summary svelte-imi3zo"><div class="summary-item svelte-imi3zo"><span class="summary-label svelte-imi3zo">Clear Until:</span> <span class="summary-value svelte-imi3zo"> </span></div> <div class="summary-item svelte-imi3zo"><span class="summary-label svelte-imi3zo">Action:</span> <span class="summary-value danger svelte-imi3zo">All transactions up to this date will be deleted</span></div></div>'),ut=x('<div class="loading-state svelte-imi3zo"><div class="loading-spinner svelte-imi3zo"></div> <p>Loading customers...</p></div>'),pt=x('<tr><td class="select-column svelte-imi3zo"><label class="checkbox-label svelte-imi3zo"><input type="checkbox" class="select-checkbox svelte-imi3zo"/> <span class="checkbox-custom"></span></label></td><td class="customer-code svelte-imi3zo"> </td><td class="customer-name svelte-imi3zo"> </td><td class="customer-email svelte-imi3zo"> </td><td class="customer-phone svelte-imi3zo"> </td><td class="transaction-count svelte-imi3zo"> </td><td class="total-amount svelte-imi3zo"> </td><td class="registration-date svelte-imi3zo"> </td></tr>'),_t=x('<table class="customer-table svelte-imi3zo"><thead><tr><th class="select-column svelte-imi3zo"><label class="checkbox-label svelte-imi3zo"><input type="checkbox" class="select-checkbox svelte-imi3zo"/> <span class="checkbox-custom"></span></label></th><th class="svelte-imi3zo">Code</th><th class="svelte-imi3zo">Customer Name</th><th class="svelte-imi3zo">Email</th><th class="svelte-imi3zo">Phone</th><th class="svelte-imi3zo">Transactions</th><th class="svelte-imi3zo">Total Amount</th><th class="svelte-imi3zo">Registration</th></tr></thead><tbody></tbody></table>'),ht=x('<div class="no-results svelte-imi3zo"><div class="no-results-icon svelte-imi3zo">üë•</div> <h3 class="svelte-imi3zo">No customers found</h3> <p class="svelte-imi3zo">Try adjusting your search criteria</p></div>'),zt=x('<div class="selection-summary svelte-imi3zo"><h3 class="svelte-imi3zo">Selected Customers Summary</h3> <div class="summary-stats svelte-imi3zo"><div class="stat-item svelte-imi3zo"><span class="stat-label svelte-imi3zo">Customers Selected:</span> <span class="stat-value svelte-imi3zo"> </span></div> <div class="stat-item svelte-imi3zo"><span class="stat-label svelte-imi3zo">Total Transactions:</span> <span class="stat-value svelte-imi3zo"> </span></div> <div class="stat-item svelte-imi3zo"><span class="stat-label svelte-imi3zo">Total Amount:</span> <span class="stat-value svelte-imi3zo"> </span></div></div></div>'),ft=x('<div class="summary-section svelte-imi3zo"><h4 class="svelte-imi3zo">Date-Based Deletion</h4> <ul class="svelte-imi3zo"><li class="svelte-imi3zo"><strong>Clear Until Date:</strong> </li> <li class="svelte-imi3zo"><strong>Scope:</strong> All transactions up to and including this date</li></ul></div>'),bt=x('<div class="summary-section svelte-imi3zo"><h4 class="svelte-imi3zo">Customer-Specific Deletion</h4> <ul class="svelte-imi3zo"><li class="svelte-imi3zo"><strong>Selected Customers:</strong> </li> <li class="svelte-imi3zo"><strong>Total Transactions:</strong> </li> <li class="svelte-imi3zo"><strong>Total Amount:</strong> </li></ul></div>'),gt=x('<span class="loading-spinner svelte-imi3zo"></span> Deleting...',1),yt=x('<div class="modal-overlay svelte-imi3zo"><div class="modal-content svelte-imi3zo"><div class="modal-header svelte-imi3zo"><h2 class="svelte-imi3zo">Confirm Transaction Deletion</h2> <button class="modal-close svelte-imi3zo">‚úï</button></div> <div class="modal-body svelte-imi3zo"><div class="confirmation-warning svelte-imi3zo"><div class="warning-icon-large svelte-imi3zo">‚ö†Ô∏è</div> <h3 class="svelte-imi3zo">This action cannot be undone!</h3> <p class="svelte-imi3zo">You are about to permanently delete transaction data. Please review the details below:</p></div> <div class="deletion-summary svelte-imi3zo"><!> <!></div> <div class="confirmation-input svelte-imi3zo"><p class="svelte-imi3zo"><strong>Type "DELETE" to confirm:</strong></p> <input type="text" placeholder="Type DELETE to confirm" class="confirm-input svelte-imi3zo"/></div></div> <div class="modal-footer svelte-imi3zo"><button class="btn btn-secondary svelte-imi3zo">Cancel</button> <button class="btn btn-danger svelte-imi3zo"><!></button></div></div></div>'),Ct=x('<div class="clear-transactions-page svelte-imi3zo"><div class="page-header svelte-imi3zo"><div class="header-content svelte-imi3zo"><div class="header-text svelte-imi3zo"><h1 class="svelte-imi3zo">Clear Transactions</h1> <p class="header-description svelte-imi3zo">Remove transaction data by date range and/or specific customers. This action cannot be undone.</p></div> <div class="header-actions"><button><span class="button-icon svelte-imi3zo">üóëÔ∏è</span> Clear Selected Data</button></div></div></div> <div class="warning-notice svelte-imi3zo"><div class="warning-icon svelte-imi3zo">‚ö†Ô∏è</div> <div class="warning-content svelte-imi3zo"><h3 class="svelte-imi3zo">Important Warning</h3> <p class="svelte-imi3zo">Clearing transactions will permanently delete the selected data and cannot be recovered. Please ensure you have proper backups before proceeding.</p></div></div> <div class="content-grid svelte-imi3zo"><div class="card date-selection-card svelte-imi3zo"><div class="card-header svelte-imi3zo"><h2 class="svelte-imi3zo">Clear by Date</h2> <p class="svelte-imi3zo">Select date to clear all transactions up to and including the specified date</p></div> <div class="card-content svelte-imi3zo"><div class="date-inputs svelte-imi3zo"><div class="input-group svelte-imi3zo"><label for="untilDate" class="svelte-imi3zo">Clear transactions until date:</label> <input type="date" id="untilDate" class="date-input svelte-imi3zo"/></div></div> <!></div></div> <div class="card customer-selection-card svelte-imi3zo"><div class="card-header svelte-imi3zo"><h2 class="svelte-imi3zo">Clear by Customers</h2> <p class="svelte-imi3zo">Select specific customers to clear all their transaction data</p></div> <div class="card-content svelte-imi3zo"><div class="search-controls svelte-imi3zo"><div class="search-box svelte-imi3zo"><input type="text" placeholder="Search customers by name, code, email, or phone..." class="search-input svelte-imi3zo"/> <span class="search-icon svelte-imi3zo">üîç</span></div> <div class="selection-info"><span class="selected-count svelte-imi3zo"> </span></div></div> <div class="customer-table-container svelte-imi3zo"><!> <!></div> <!></div></div></div></div> <!>',1);function Mt(Oe,Me){at(Me,!1);const d=z(),q=z(),V=z(),ie=z();let S=z(""),T=z(""),l=z([]),G=z(!1),X=z(!1),w=z("date"),Z=z(!1),le=z(""),F=z(!0),P=z([]);function Pe(){e(G)?r(l,e(d).map(s=>s.id)):r(l,[])}function Ue(s){e(l).includes(s)?r(l,e(l).filter(o=>o!==s)):r(l,[...e(l),s]),r(G,e(l).length===e(d).length)}function $e(){e(q)&&e(V)?r(w,"both"):e(q)?r(w,"date"):r(w,"customers"),r(X,!0)}function oe(){r(X,!1)}async function Be(){r(Z,!0);try{let s=0;if(e(w)==="date"){const{data:o,error:n}=await ae.from(se.CUSTOMER_TRANSACTIONS).delete().lte("transaction_date",e(S));if(n)throw n;s=o?.length||0}else if(e(w)==="customers"){const o=e(P).filter(p=>e(l).includes(p.id)).map(p=>p.customer_code),{data:n,error:m}=await ae.from(se.CUSTOMER_TRANSACTIONS).delete().in("customer_mobile",o);if(m)throw m;s=n?.length||0}else{const o=e(P).filter(p=>e(l).includes(p.id)).map(p=>p.customer_code),{data:n,error:m}=await ae.from(se.CUSTOMER_TRANSACTIONS).delete().in("customer_mobile",o).lte("transaction_date",e(S));if(m)throw m;s=n?.length||0}r(S,""),r(l,[]),r(G,!1),r(X,!1),await re(),alert(`Successfully cleared ${s} transactions!`)}catch(s){console.error("Error clearing transactions:",s),alert("Error clearing transactions. Please try again.")}finally{r(Z,!1)}}async function re(){r(F,!0);try{const{data:s,error:o}=await ae.from(se.CUSTOMERS).select(`
          id,
          mobile,
          name,
          email,
          address,
          created_at
        `).order("created_at",{ascending:!1});o?(console.error("Error loading customers:",o),r(P,[])):r(P,(s||[]).map(n=>({id:n.id,customer_code:n.mobile,full_name:n.name||`Customer ${n.mobile}`,email:n.email||"",phone:n.mobile,total_transactions:0,total_amount:0,created_at:n.created_at})))}catch(s){console.error("Error loading customers:",s),r(P,[])}finally{r(F,!1)}}const Ie=new Date().toISOString().split("T")[0];tt(async()=>{await re()}),Y(()=>(e(P),e(T)),()=>{r(d,e(P).filter(s=>s.full_name.toLowerCase().includes(e(T).toLowerCase())||s.customer_code.toLowerCase().includes(e(T).toLowerCase())||s.email.toLowerCase().includes(e(T).toLowerCase())||s.phone.includes(e(T))))}),Y(()=>e(S),()=>{r(q,e(S))}),Y(()=>e(l),()=>{r(V,e(l).length>0)}),Y(()=>(e(q),e(V)),()=>{r(ie,e(q)||e(V))}),Y(()=>(e(d),e(l)),()=>{e(d).length>0&&r(G,e(d).every(s=>e(l).includes(s.id)))}),Y(()=>e(T),()=>{e(T)!==void 0&&re()}),st(),dt();var ge=Ct(),ne=it(ge),ve=a(ne),ye=a(ve),Ce=i(a(ye),2),ce=a(Ce);let xe;t(Ce),t(ye),t(ve);var Se=i(ve,4),de=a(Se),Te=i(a(de),2),me=a(Te),we=a(me),ue=i(a(we),2);Q(ue),t(we),t(me);var je=i(me,2);{var qe=s=>{var o=mt(),n=a(o),m=i(a(n),2),p=a(m,!0);t(m),t(n),j(2),t(o),I(()=>h(p,e(S))),b(s,o)};M(je,s=>{e(q)&&s(qe)})}t(Te),t(de);var De=i(de,2),Ee=i(a(De),2),pe=a(Ee),_e=a(pe),ke=a(_e);Q(ke),j(2),t(_e);var Ae=i(_e,2),Le=a(Ae),Ge=a(Le);t(Le),t(Ae),t(pe);var he=i(pe,2),Re=a(he);{var We=s=>{var o=ut();b(s,o)},Ye=s=>{var o=_t(),n=a(o),m=a(n),p=a(m),A=a(p),g=a(A);Q(g),j(2),t(A),t(p),j(7),t(m),t(n);var L=i(n);rt(L,5,()=>e(d),D=>D.id,(D,v)=>{var E=pt();let U;var _=a(E),y=a(_),W=a(y);Q(W),j(2),t(y),t(_);var R=i(_),ze=a(R,!0);t(R);var H=i(R),fe=a(H,!0);t(H);var c=i(H),f=a(c,!0);t(c);var k=i(c),N=a(k,!0);t(k);var $=i(k),J=a($,!0);t($);var K=i($),ee=a(K);t(K);var te=i(K),C=a(te,!0);t(te),t(E),I((B,Xe,Ze,et)=>{U=Ne(E,1,"customer-row svelte-imi3zo",null,U,B),vt(W,Xe),h(ze,(e(v),u(()=>e(v).customer_code))),h(fe,(e(v),u(()=>e(v).full_name))),h(f,(e(v),u(()=>e(v).email||"N/A"))),h(N,(e(v),u(()=>e(v).phone))),h(J,(e(v),u(()=>e(v).total_transactions))),h(ee,`${Ze??""} SAR`),h(C,et)},[()=>({selected:e(l).includes(e(v).id)}),()=>(e(l),e(v),u(()=>e(l).includes(e(v).id))),()=>(e(v),u(()=>e(v).total_amount.toLocaleString())),()=>(e(v),u(()=>new Date(e(v).created_at).toLocaleDateString()))]),O("change",W,()=>Ue(e(v).id)),b(D,E)}),t(L),t(o),ct(g,()=>e(G),D=>r(G,D)),O("change",g,Pe),b(s,o)};M(Re,s=>{e(F)?s(We):s(Ye,!1)})}var Fe=i(Re,2);{var He=s=>{var o=ht();b(s,o)};M(Fe,s=>{e(F),e(d),u(()=>!e(F)&&e(d).length===0)&&s(He)})}t(he);var Je=i(he,2);{var Ke=s=>{var o=zt(),n=i(a(o),2),m=a(n),p=i(a(m),2),A=a(p,!0);t(p),t(m);var g=i(m,2),L=i(a(g),2),D=a(L,!0);t(L),t(g);var v=i(g,2),E=i(a(v),2),U=a(E);t(E),t(v),t(n),t(o),I((_,y)=>{h(A,(e(l),u(()=>e(l).length))),h(D,_),h(U,`${y??""} SAR`)},[()=>(e(d),e(l),u(()=>e(d).filter(_=>e(l).includes(_.id)).reduce((_,y)=>_+y.total_transactions,0))),()=>(e(d),e(l),u(()=>e(d).filter(_=>e(l).includes(_.id)).reduce((_,y)=>_+y.total_amount,0).toLocaleString()))]),b(s,o)};M(Je,s=>{e(l),u(()=>e(l).length>0)&&s(Ke)})}t(Ee),t(De),t(Se),t(ne);var Qe=i(ne,2);{var Ve=s=>{var o=yt(),n=a(o),m=a(n),p=i(a(m),2);t(m);var A=i(m,2),g=i(a(A),2),L=a(g);{var D=c=>{var f=ft(),k=i(a(f),2),N=a(k),$=i(a(N));t(N),j(2),t(k),t(f),I(()=>h($,` ${e(S)??""}`)),b(c,f)};M(L,c=>{(e(w)==="date"||e(w)==="both")&&c(D)})}var v=i(L,2);{var E=c=>{var f=bt(),k=i(a(f),2),N=a(k),$=i(a(N));t(N);var J=i(N,2),K=i(a(J));t(J);var ee=i(J,2),te=i(a(ee));t(ee),t(k),t(f),I((C,B)=>{h($,` ${e(l),u(()=>e(l).length)??""}`),h(K,` ${C??""}`),h(te,` ${B??""} SAR`)},[()=>(e(d),e(l),u(()=>e(d).filter(C=>e(l).includes(C.id)).reduce((C,B)=>C+B.total_transactions,0))),()=>(e(d),e(l),u(()=>e(d).filter(C=>e(l).includes(C.id)).reduce((C,B)=>C+B.total_amount,0).toLocaleString()))]),b(c,f)};M(v,c=>{(e(w)==="customers"||e(w)==="both")&&c(E)})}t(g);var U=i(g,2),_=i(a(U),2);Q(_),t(U),t(A);var y=i(A,2),W=a(y),R=i(W,2),ze=a(R);{var H=c=>{var f=gt();j(),b(c,f)},fe=c=>{var f=ot("Permanently Delete");b(c,f)};M(ze,c=>{e(Z)?c(H):c(fe,!1)})}t(R),t(y),t(n),t(o),I(()=>R.disabled=e(le)!=="DELETE"||e(Z)),O("click",p,oe),be(_,()=>e(le),c=>r(le,c)),O("click",W,oe),O("click",R,Be),O("click",n,c=>c.stopPropagation()),O("click",o,oe),b(s,o)};M(Qe,s=>{e(X)&&s(Ve)})}I(s=>{xe=Ne(ce,1,"clear-button svelte-imi3zo",null,xe,s),ce.disabled=!e(ie),nt(ue,"max",Ie),h(Ge,`${e(l),u(()=>e(l).length)??""} of ${e(d),u(()=>e(d).length)??""} selected`)},[()=>({enabled:e(ie)})]),O("click",ce,$e),be(ue,()=>e(S),s=>r(S,s)),be(ke,()=>e(T),s=>r(T,s)),b(Oe,ge),lt()}export{Mt as component};
