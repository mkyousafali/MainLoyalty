import"../chunks/DsnmJJEf.js";import"../chunks/69_IOA4Y.js";import{l as Be,m as g,J as Ne,t as k,n as f,o as Se,$ as De,w as s,v as t,a as e,y as q,z as i,G as W,H as Te,C as ze,E as $,s as n,x as R,A as Ae,B as A,I as M}from"../chunks/Ck91ypkQ.js";import{i as P}from"../chunks/RujGBxXx.js";import{e as Ie,i as Le}from"../chunks/D775oJua.js";import{r as B}from"../chunks/DvH4tfbe.js";import{s as I}from"../chunks/B38bOHRo.js";import{a as N}from"../chunks/C4HntxLm.js";import{b as $e}from"../chunks/xkiwYR4x.js";import{i as Fe}from"../chunks/6tn_K0LM.js";import{g as ce}from"../chunks/Bc_wzfnz.js";import{s as S}from"../chunks/CIOq__Tp.js";var Ye=g('<span class="loading-spinner svelte-1cw7620"></span> <span>Checking...</span>',1),Ge=g("<span>Verify Mobile Number</span>"),He=g('<div class="form-section svelte-1cw7620"><div class="form-group svelte-1cw7620"><label for="mobile" class="form-label svelte-1cw7620">Mobile Number</label> <input id="mobile" type="tel" placeholder="Enter your 10-digit mobile number" class="form-input svelte-1cw7620" maxlength="10" autocomplete="tel"/> <div class="form-hint svelte-1cw7620">Enter the mobile number you were registered with</div></div> <button class="btn btn-primary svelte-1cw7620"><!></button></div>'),Oe=g("<option> </option>"),Ue=g('<span class="loading-spinner svelte-1cw7620"></span> <span>Registering...</span>',1),Ve=g("<span>Complete Registration</span>"),We=g(`<div class="form-section svelte-1cw7620"><div class="verified-mobile svelte-1cw7620"><span class="verified-icon svelte-1cw7620">‚úÖ</span> <span class="verified-text svelte-1cw7620"> </span></div> <div class="form-grid svelte-1cw7620"><div class="form-group svelte-1cw7620"><label for="name" class="form-label svelte-1cw7620">Full Name *</label> <input id="name" type="text" placeholder="Enter your full name" class="form-input svelte-1cw7620" required/></div> <div class="form-group svelte-1cw7620"><label for="email" class="form-label svelte-1cw7620">Email Address</label> <input id="email" type="email" placeholder="Enter your email (optional)" class="form-input svelte-1cw7620"/></div> <div class="form-group svelte-1cw7620"><label for="area" class="form-label svelte-1cw7620">Area / Place *</label> <input id="area" type="text" placeholder="Enter your area or city" class="form-input svelte-1cw7620" required/></div> <div class="form-group svelte-1cw7620"><label for="branch" class="form-label svelte-1cw7620">Preferred Branch *</label> <select id="branch" class="form-select svelte-1cw7620" required><option>Select your preferred branch</option><!></select></div> <div class="form-group svelte-1cw7620"><label for="password" class="form-label svelte-1cw7620">Password *</label> <input id="password" type="password" placeholder="Create a password (min 6 characters)" class="form-input svelte-1cw7620" minlength="6" required/></div> <div class="form-group svelte-1cw7620"><label for="confirmPassword" class="form-label svelte-1cw7620">Confirm Password *</label> <input id="confirmPassword" type="password" placeholder="Confirm your password" class="form-input svelte-1cw7620" required/></div></div> <div class="terms-section svelte-1cw7620"><div class="terms-text svelte-1cw7620">By registering, you agree to our Terms & Conditions and Privacy Policy.
            You will start with a Bronze loyalty card.</div></div> <div class="form-actions svelte-1cw7620"><button class="btn btn-secondary svelte-1cw7620">‚Üê Back</button> <button class="btn btn-primary svelte-1cw7620"><!></button></div></div>`),je=g('<div class="success-section svelte-1cw7620"><div class="success-icon svelte-1cw7620">üéâ</div> <h2 class="success-title svelte-1cw7620">Registration Successful!</h2> <div class="success-details"><p class="success-message svelte-1cw7620">Welcome to Urban Market Loyalty Program! Your account has been created successfully.</p> <div class="success-info svelte-1cw7620"><div class="info-item svelte-1cw7620"><span class="info-label svelte-1cw7620">Mobile Number:</span> <span class="info-value svelte-1cw7620"> </span></div> <div class="info-item svelte-1cw7620"><span class="info-label svelte-1cw7620">Full Name:</span> <span class="info-value svelte-1cw7620"> </span></div> <div class="info-item svelte-1cw7620"><span class="info-label svelte-1cw7620">Card Type:</span> <span class="info-value svelte-1cw7620">Bronze</span></div> <div class="info-item svelte-1cw7620"><span class="info-label svelte-1cw7620">Starting Points:</span> <span class="info-value svelte-1cw7620">0</span></div></div></div> <div class="success-actions svelte-1cw7620"><button class="btn btn-primary svelte-1cw7620">Go to Dashboard</button> <button class="btn btn-secondary svelte-1cw7620">Login Now</button></div></div>'),Je=g('<div class="error-message svelte-1cw7620"><span class="error-icon svelte-1cw7620">‚ùå</span> <span class="error-text svelte-1cw7620"> </span></div>'),Ke=g('<div class="registration-container svelte-1cw7620"><div class="registration-card svelte-1cw7620"><div class="registration-header svelte-1cw7620"><h1 class="registration-title svelte-1cw7620">üéØ Customer Registration</h1> <p class="registration-subtitle svelte-1cw7620"><!></p></div> <div class="progress-indicator svelte-1cw7620"><div><div class="step-number svelte-1cw7620">1</div> <div class="step-label svelte-1cw7620">Mobile Verification</div></div> <div></div> <div><div class="step-number svelte-1cw7620">2</div> <div class="step-label svelte-1cw7620">Registration Form</div></div> <div></div> <div><div class="step-number svelte-1cw7620">3</div> <div class="step-label svelte-1cw7620">Complete</div></div></div> <!> <!> <!> <!></div></div>');function cs(ve,de){Be(de,!1);let b=q(1),w=q(""),y=q(!1),d=q(""),j=q([]),r=q({name:"",email:"",area:"",branch_id:"",password:"",confirmPassword:""});async function me(){if(!e(w)){n(d,"Please enter your mobile number");return}const a=e(w).replace(/\D/g,"");if(a.length!==10){n(d,"Please enter a valid 10-digit mobile number");return}n(y,!0),n(d,"");try{const{data:l,error:o}=await S.from("customer_numbers").select("*").eq("customer_code",a).eq("status","not_registered").single();if(o||!l){n(d,"This mobile number is not eligible for registration. Please contact support.");return}const{data:m,error:v}=await S.from("customers").select("id").eq("customer_code",a).single();if(m){n(d,"This mobile number is already registered. Please login instead.");return}n(w,a),n(b,2)}catch(l){console.error("Eligibility check error:",l),n(d,"An error occurred while checking eligibility. Please try again.")}finally{n(y,!1)}}async function pe(){if(!e(r).name.trim()){n(d,"Please enter your full name");return}if(!e(r).area.trim()){n(d,"Please enter your area/place");return}if(!e(r).branch_id){n(d,"Please select your preferred branch");return}if(e(r).password.length<6){n(d,"Password must be at least 6 characters long");return}if(e(r).password!==e(r).confirmPassword){n(d,"Passwords do not match");return}n(y,!0),n(d,"");try{const{data:a}=await S.from("card_types").select("id").eq("name_en","Bronze").single(),l=a?.id,o=btoa(e(r).password),{data:m,error:v}=await S.from("customers").insert({customer:e(w),name:e(r).name.trim(),email:e(r).email.trim()||null,area:e(r).area.trim(),branch_id:e(r).branch_id,card_type_id:l,points:0,total_spent:0,status:"active",valid_until:new Date(Date.now()+365*24*60*60*1e3).toISOString().split("T")[0],password_hash:o,joined_at:new Date().toISOString()}).select().single();if(v)throw console.error("Customer insert error:",v),v;await S.from("customer_numbers").update({status:"registered"}).eq("customer_code",e(w)),await S.from("notifications").insert({type:"system",message:`Welcome ${e(r).name}! Your loyalty account has been created successfully.`}),n(b,3)}catch(a){console.error("Registration error:",a),n(d,"Registration failed. Please try again or contact support.")}finally{n(y,!1)}}function ue(a){let o=a.target.value.replace(/\D/g,"");o.length>10&&(o=o.slice(0,10)),n(w,o)}function fe(){n(b,1),n(d,""),n(r,{name:"",email:"",area:"",branch_id:"",password:"",confirmPassword:""})}Fe();var F=Ke();Ne(a=>{De.title="Customer Registration - Urban Market Loyalty"});var J=t(F),Y=t(J),K=s(t(Y),2),be=t(K);{var we=a=>{var l=W("Enter your mobile number to start registration");f(a,l)},_e=a=>{var l=Te(),o=ze(l);{var m=p=>{var _=W("Complete your profile information");f(p,_)},v=p=>{var _=W("Registration completed successfully!");f(p,_)};P(o,p=>{e(b)===2?p(m):p(v,!1)},!0)}f(a,l)};P(be,a=>{e(b)===1?a(we):a(_e,!1)})}i(K),i(Y);var G=s(Y,2),Q=t(G),X=s(Q,2),Z=s(X,2),ee=s(Z,2),ge=s(ee,2);i(G);var se=s(G,2);{var ye=a=>{var l=He(),o=t(l),m=s(t(o),2);B(m),$(2),i(o);var v=s(o,2),p=t(v);{var _=u=>{var h=Ye();$(2),f(u,h)},x=u=>{var h=Ge();f(u,h)};P(p,u=>{e(y)?u(_):u(x,!1)})}i(v),i(l),k(()=>v.disabled=!e(w)||e(y)),N(m,()=>e(w),u=>n(w,u)),R("input",m,ue),R("click",v,me),f(a,l)};P(se,a=>{e(b)===1&&a(ye)})}var ae=s(se,2);{var he=a=>{var l=We(),o=t(l),m=s(t(o),2),v=t(m);i(m),i(o);var p=s(o,2),_=t(p),x=s(t(_),2);B(x),i(_);var u=s(_,2),h=s(t(u),2);B(h),i(u);var E=s(u,2),D=s(t(E),2);B(D),i(E);var T=s(E,2),H=s(t(T),2);k(()=>{e(r),Ae(()=>{e(j)})});var O=t(H);O.value=O.__value="";var ke=s(O);Ie(ke,1,()=>e(j),Le,(c,C)=>{var z=Oe(),Me=t(z,!0);i(z);var ne={};k(()=>{A(Me,e(C).name_en),ne!==(ne=e(C).id)&&(z.value=(z.__value=e(C).id)??"")}),f(c,z)}),i(H),i(T);var U=s(T,2),te=s(t(U),2);B(te),i(U);var ie=s(U,2),le=s(t(ie),2);B(le),i(ie),i(p);var oe=s(p,4),V=t(oe),L=s(V,2),Ee=t(L);{var qe=c=>{var C=Ue();$(2),f(c,C)},Re=c=>{var C=Ve();f(c,C)};P(Ee,c=>{e(y)?c(qe):c(Re,!1)})}i(L),i(oe),i(l),k(()=>{A(v,`Mobile ${e(w)??""} verified successfully`),V.disabled=e(y),L.disabled=e(y)}),N(x,()=>e(r).name,c=>M(r,e(r).name=c)),N(h,()=>e(r).email,c=>M(r,e(r).email=c)),N(D,()=>e(r).area,c=>M(r,e(r).area=c)),$e(H,()=>e(r).branch_id,c=>M(r,e(r).branch_id=c)),N(te,()=>e(r).password,c=>M(r,e(r).password=c)),N(le,()=>e(r).confirmPassword,c=>M(r,e(r).confirmPassword=c)),R("click",V,fe),R("click",L,pe),f(a,l)};P(ae,a=>{e(b)===2&&a(he)})}var re=s(ae,2);{var Pe=a=>{var l=je(),o=s(t(l),4),m=s(t(o),2),v=t(m),p=s(t(v),2),_=t(p,!0);i(p),i(v);var x=s(v,2),u=s(t(x),2),h=t(u,!0);i(u),i(x),$(4),i(m),i(o);var E=s(o,2),D=t(E),T=s(D,2);i(E),i(l),k(()=>{A(_,e(w)),A(h,e(r).name)}),R("click",D,()=>ce("/dashboard")),R("click",T,()=>ce("/login")),f(a,l)};P(re,a=>{e(b)===3&&a(Pe)})}var xe=s(re,2);{var Ce=a=>{var l=Je(),o=s(t(l),2),m=t(o,!0);i(o),i(l),k(()=>A(m,e(d))),f(a,l)};P(xe,a=>{e(d)&&a(Ce)})}i(J),i(F),k(()=>{I(Q,1,`progress-step ${e(b)>=1?"active":""}`,"svelte-1cw7620"),I(X,1,`progress-line ${e(b)>=2?"active":""}`,"svelte-1cw7620"),I(Z,1,`progress-step ${e(b)>=2?"active":""}`,"svelte-1cw7620"),I(ee,1,`progress-line ${e(b)>=3?"active":""}`,"svelte-1cw7620"),I(ge,1,`progress-step ${e(b)>=3?"active":""}`,"svelte-1cw7620")}),f(ve,F),Se()}export{cs as component};
