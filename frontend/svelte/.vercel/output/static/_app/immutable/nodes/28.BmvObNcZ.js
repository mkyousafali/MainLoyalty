import"../chunks/DsnmJJEf.js";import"../chunks/69_IOA4Y.js";import{o as Ve}from"../chunks/Y1pQyyvi.js";import{l as We,m as _,t as x,x as I,n as f,o as Xe,w as o,v as r,s as d,y as w,z as a,a as e,B as v,H as Ye,C as Ze,A as ve,I as H}from"../chunks/Ck91ypkQ.js";import{i as Y}from"../chunks/RujGBxXx.js";import{e as ue,i as pe}from"../chunks/D775oJua.js";import{r as me}from"../chunks/DvH4tfbe.js";import{s as be}from"../chunks/B38bOHRo.js";import{a as fe}from"../chunks/C4HntxLm.js";import{b as xe}from"../chunks/xkiwYR4x.js";import{p as et}from"../chunks/D4Caz1gY.js";import{i as tt}from"../chunks/6tn_K0LM.js";import{s as k}from"../chunks/CIOq__Tp.js";var at=_('<div class="p-8 text-center"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"></div> <p class="text-gray-600 mt-2">Loading users...</p></div>'),rt=_('<div class="p-8 text-center text-gray-500">No users found. Create your first user to get started.</div>'),st=_('<tr class="hover:bg-gray-50"><td class="px-6 py-4 whitespace-nowrap"><div class="flex items-center"><div class="w-10 h-10 bg-gray-300 rounded-full flex items-center justify-center"><span class="text-sm font-medium text-gray-700"> </span></div> <div class="ml-4"><div class="text-sm font-medium text-gray-900"> </div> <div class="text-sm text-gray-500"> </div></div></div></td><td class="px-6 py-4 whitespace-nowrap"><span> </span></td><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"> </td><td class="px-6 py-4 whitespace-nowrap"><span> </span></td><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"> </td><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"> </td><td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2"><button class="text-blue-600 hover:text-blue-900">Edit</button> <button> </button> <button class="text-red-600 hover:text-red-900">Delete</button></td></tr>'),ot=_('<div class="overflow-x-auto"><table class="min-w-full divide-y divide-gray-200"><thead class="bg-gray-50"><tr><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">User</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Role</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Branch</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Last Login</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Created</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th></tr></thead><tbody class="bg-white divide-y divide-gray-200"></tbody></table></div>'),it=_("<option> </option>"),dt=_("<option> </option>"),lt=_('<div class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"><div class="relative top-20 mx-auto p-5 border w-full max-w-md shadow-lg rounded-md bg-white"><div class="mt-3"><h3 class="text-lg font-medium text-gray-900 mb-4"> </h3> <form class="space-y-4"><div><label class="block text-sm font-medium text-gray-700 mb-1">Full Name *</label> <input type="text" required class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="John Doe"/></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">Email Address *</label> <input type="email" required class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="john@example.com"/></div> <div><label class="block text-sm font-medium text-gray-700 mb-1"> </label> <input type="password" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="••••••••"/></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">Role</label> <select class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"><option>Select a role...</option><!></select></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">Branch</label> <select class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"><option>Select a branch...</option><!></select></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">Status</label> <select class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"><option>Active</option><option>Inactive</option><option>Blocked</option></select></div> <div class="flex justify-end space-x-2 mt-6"><button type="button" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400">Cancel</button> <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-400"> </button></div></form></div></div></div>'),nt=_('<div class="fixed bottom-4 right-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded z-50"> </div>'),ct=_('<div class="fixed bottom-4 right-4 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded z-50"> </div>'),vt=_('<div class="p-6"><div class="max-w-7xl mx-auto"><div class="mb-8"><div class="flex justify-between items-center"><div><h1 class="text-3xl font-bold text-gray-900 mb-2">User Management</h1> <p class="text-gray-600">Manage admin users, roles, and permissions.</p></div> <button class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">+ Add User</button></div></div> <div class="bg-white rounded-lg shadow overflow-hidden"><div class="px-6 py-4 border-b border-gray-200"><h2 class="text-lg font-semibold"> </h2></div> <!></div> <!> <!> <!></div></div>');function Et(Ue,Ee){We(Ee,!1);let Z=w([]),se=w([]),oe=w([]),g=w(!1),U=w(""),D=w(""),ee=w(!1),y=w(null),i=w({name:"",email:"",password:"",branch_id:"",role_id:"",status:"active"});Ve(()=>{De(),te()});async function De(){try{const[t,s]=await Promise.all([k.from("branches").select("*").order("name_en"),k.from("roles").select("*").order("name")]);d(se,t.data||[]),d(oe,s.data||[])}catch(t){d(U,`Failed to load initial data: ${t.message}`)}}async function te(){try{d(g,!0);const{data:t,error:s}=await k.from("users").select("*").order("created_at",{ascending:!1});if(s)throw s;const[p,$]=await Promise.all([k.from("branches").select("id, name_en"),k.from("roles").select("id, name")]),E={},m={};p.data?.forEach(l=>{E[l.id]=l}),$.data?.forEach(l=>{m[l.id]=l}),d(Z,(t||[]).map(l=>({...l,branches:l.branch_id?E[l.branch_id]:null,roles:l.role_id?m[l.role_id]:null})))}catch(t){d(U,`Failed to load users: ${t.message}`)}finally{d(g,!1)}}function Ce(){d(y,null),d(i,{name:"",email:"",password:"",branch_id:"",role_id:"",status:"active"}),d(ee,!0)}function Me(t){d(y,t),d(i,{name:t.name,email:t.email,password:"",branch_id:t.branch_id||"",role_id:t.role_id||"",status:t.status}),d(ee,!0)}function _e(){d(ee,!1),d(y,null),d(U,""),d(D,"")}async function Se(){try{d(g,!0);const t={name:e(i).name.trim(),email:e(i).email.trim().toLowerCase(),branch_id:e(i).branch_id||null,role_id:e(i).role_id||null,status:e(i).status};if(e(i).password&&(t.password_hash=e(i).password),e(y)){const{error:s}=await k.from("users").update(t).eq("id",e(y).id);if(s)throw s;d(D,"User updated successfully!")}else{if(!e(i).password)throw new Error("Password is required for new users");const{error:s}=await k.from("users").insert(t);if(s)throw s;d(D,"User created successfully!")}_e(),te()}catch(t){d(U,`Failed to save user: ${t.message}`)}finally{d(g,!1)}}async function Ae(t){try{const s=t.status==="active"?"blocked":"active",{error:p}=await k.from("users").update({status:s}).eq("id",t.id);if(p)throw p;d(D,`User ${s==="active"?"activated":"blocked"} successfully!`),te()}catch(s){d(U,`Failed to update user status: ${s.message}`)}}async function Le(t){if(confirm(`Are you sure you want to delete user "${t.name}"? This action cannot be undone.`))try{d(g,!0);const{error:s}=await k.from("users").delete().eq("id",t.id);if(s)throw s;d(D,"User deleted successfully!"),te()}catch(s){d(U,`Failed to delete user: ${s.message}`)}finally{d(g,!1)}}function Re(t){switch(t?.toLowerCase()){case"admin":return"bg-red-100 text-red-800";case"manager":return"bg-blue-100 text-blue-800";case"staff":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}}function $e(t){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)}tt();var ie=vt(),ge=r(ie),de=r(ge),ye=r(de),qe=o(r(ye),2);a(ye),a(de);var le=o(de,2),ne=r(le),he=r(ne),Be=r(he);a(he),a(ne);var Fe=o(ne,2);{var Ne=t=>{var s=at();f(t,s)},je=t=>{var s=Ye(),p=Ze(s);{var $=m=>{var l=rt();f(m,l)},E=m=>{var l=ot(),q=r(l),J=o(r(q));ue(J,5,()=>e(Z),pe,(T,c)=>{var C=st(),M=r(C),ae=r(M),S=r(ae),B=r(S),G=r(B,!0);a(B),a(S);var F=o(S,2),K=r(F),O=r(K,!0);a(K);var N=o(K,2),Q=r(N,!0);a(N),a(F),a(ae),a(M);var V=o(M),A=r(V),W=r(A,!0);a(A),a(V);var L=o(V),X=r(L,!0);a(L);var j=o(L),z=r(j),re=r(z,!0);a(z),a(j);var R=o(j),ce=r(R,!0);a(R);var n=o(R),h=r(n,!0);a(n);var u=o(n),P=r(u),b=o(P,2),Je=r(b,!0);a(b);var Te=o(b,2);a(u),a(C),x((Ge,Ke,Oe,Qe)=>{v(G,Ge),v(O,e(c).name),v(Q,e(c).email),be(A,1,`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${Ke??""}`),v(W,e(c).roles?.name||"No Role"),v(X,e(c).branches?.name_en||"No Branch"),be(z,1,`inline-flex px-2 py-1 text-xs font-semibold rounded-full
                                 ${e(c).status==="active"?"bg-green-100 text-green-800":e(c).status==="blocked"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`),v(re,e(c).status),v(ce,Oe),v(h,Qe),be(b,1,e(c).status==="active"?"text-red-600 hover:text-red-900":"text-green-600 hover:text-green-900"),v(Je,e(c).status==="active"?"Block":"Activate")},[()=>e(c).name.charAt(0).toUpperCase(),()=>Re(e(c).roles?.name),()=>e(c).last_login?new Date(e(c).last_login).toLocaleDateString():"Never",()=>new Date(e(c).created_at).toLocaleDateString()]),I("click",P,()=>Me(e(c))),I("click",b,()=>Ae(e(c))),I("click",Te,()=>Le(e(c))),f(T,C)}),a(J),a(q),a(l),f(m,l)};Y(p,m=>{e(Z).length===0?m($):m(E,!1)},!0)}f(t,s)};Y(Fe,t=>{e(g)?t(Ne):t(je,!1)})}a(le);var we=o(le,2);{var ze=t=>{var s=lt(),p=r(s),$=r(p),E=r($),m=r(E,!0);a(E);var l=o(E,2),q=r(l),J=o(r(q),2);me(J),a(q);var T=o(q,2),c=o(r(T),2);me(c),a(T);var C=o(T,2),M=r(C),ae=r(M);a(M);var S=o(M,2);me(S),a(C);var B=o(C,2),G=o(r(B),2);x(()=>{e(i),ve(()=>{e(oe)})});var F=r(G);F.value=F.__value="";var K=o(F);ue(K,1,()=>e(oe),pe,(n,h)=>{var u=it(),P=r(u,!0);a(u);var b={};x(()=>{v(P,e(h).name),b!==(b=e(h).id)&&(u.value=(u.__value=e(h).id)??"")}),f(n,u)}),a(G),a(B);var O=o(B,2),N=o(r(O),2);x(()=>{e(i),ve(()=>{e(se)})});var Q=r(N);Q.value=Q.__value="";var V=o(Q);ue(V,1,()=>e(se),pe,(n,h)=>{var u=dt(),P=r(u,!0);a(u);var b={};x(()=>{v(P,e(h).name_en),b!==(b=e(h).id)&&(u.value=(u.__value=e(h).id)??"")}),f(n,u)}),a(N),a(O);var A=o(O,2),W=o(r(A),2);x(()=>{e(i),ve(()=>{})});var L=r(W);L.value=L.__value="active";var X=o(L);X.value=X.__value="inactive";var j=o(X);j.value=j.__value="blocked",a(W),a(A);var z=o(A,2),re=r(z),R=o(re,2),ce=r(R,!0);a(R),a(z),a(l),a($),a(p),a(s),x(n=>{v(m,e(y)?"Edit User":"Create User"),v(ae,`Password ${e(y)?"(leave empty to keep current)":"*"}`),S.required=!e(y),R.disabled=n,v(ce,e(g)?"Saving...":e(y)?"Update":"Create")},[()=>e(g)||!$e(e(i).email)]),fe(J,()=>e(i).name,n=>H(i,e(i).name=n)),fe(c,()=>e(i).email,n=>H(i,e(i).email=n)),fe(S,()=>e(i).password,n=>H(i,e(i).password=n)),xe(G,()=>e(i).role_id,n=>H(i,e(i).role_id=n)),xe(N,()=>e(i).branch_id,n=>H(i,e(i).branch_id=n)),xe(W,()=>e(i).status,n=>H(i,e(i).status=n)),I("click",re,_e),I("submit",l,et(Se)),f(t,s)};Y(we,t=>{e(ee)&&t(ze)})}var ke=o(we,2);{var Pe=t=>{var s=nt(),p=r(s,!0);a(s),x(()=>v(p,e(U))),f(t,s)};Y(ke,t=>{e(U)&&t(Pe)})}var Ie=o(ke,2);{var He=t=>{var s=ct(),p=r(s,!0);a(s),x(()=>v(p,e(D))),f(t,s)};Y(Ie,t=>{e(D)&&t(He)})}a(ge),a(ie),x(()=>v(Be,`Users (${e(Z).length??""})`)),I("click",qe,Ce),f(Ue,ie),Xe()}export{Et as component};
