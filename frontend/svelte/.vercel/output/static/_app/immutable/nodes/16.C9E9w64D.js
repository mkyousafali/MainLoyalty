import"../chunks/DsnmJJEf.js";import"../chunks/69_IOA4Y.js";import{o as Ue}from"../chunks/Y1pQyyvi.js";import{l as Ae,m,x as g,n as v,o as je,w as o,v as r,s as d,y as B,z as s,a as e,E as ue,t as E,B as x,K as qe,I as C}from"../chunks/Ck91ypkQ.js";import{i as b}from"../chunks/RujGBxXx.js";import{e as ze,i as De}from"../chunks/D775oJua.js";import{r as q}from"../chunks/DvH4tfbe.js";import{a as M}from"../chunks/C4HntxLm.js";import{p as Fe}from"../chunks/D4Caz1gY.js";import{i as Ne}from"../chunks/6tn_K0LM.js";import{s as J}from"../chunks/CIOq__Tp.js";var Re=m('<p class="text-sm text-gray-600"> </p>'),Se=m('<div class="flex items-center text-sm"><span class="text-gray-400 mr-2">📞</span> <span> </span></div>'),$e=m('<div class="flex items-start text-sm"><span class="text-gray-400 mr-2 mt-0.5">📍</span> <span class="text-gray-600"> </span></div>'),Ie=m('<button class="text-blue-600 hover:text-blue-800" title="Website">🌐</button>'),We=m('<button class="text-pink-600 hover:text-pink-800" title="Instagram">📷</button>'),Ke=m('<button class="text-yellow-500 hover:text-yellow-700" title="Snapchat">👻</button>'),Pe=m('<div class="flex space-x-3 mb-4"><!> <!> <!></div>'),Te=m('<div class="bg-white rounded-lg shadow p-6"><div class="flex justify-between items-start mb-4"><div><h3 class="text-lg font-semibold text-gray-900"> </h3> <!></div> <div class="w-3 h-3 bg-green-400 rounded-full"></div></div> <div class="space-y-3 mb-4"><!> <!></div> <!> <div class="grid grid-cols-1 gap-4 mb-4 pt-4 border-t"><div class="text-center"><div class="text-lg font-bold text-blue-600"> </div> <div class="text-xs text-gray-500">Customers</div></div></div> <div class="flex justify-end space-x-2"><button class="text-blue-600 hover:text-blue-800 text-sm font-medium">Edit</button> <button class="text-red-600 hover:text-red-800 text-sm font-medium">Delete</button></div></div>'),Ge=m('<div class="col-span-full text-center py-12"><div class="text-gray-400 text-6xl mb-4">🏢</div> <h3 class="text-lg font-medium text-gray-900 mb-2">No Branches</h3> <p class="text-gray-500 mb-4">Create your first branch to get started.</p> <button class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">+ Add Branch</button></div>'),He=m('<div class="text-center py-8"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"></div> <p class="text-gray-600 mt-2">Loading branches...</p></div>'),Je=m('<div class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"><div class="relative top-10 mx-auto p-5 border w-full max-w-md shadow-lg rounded-md bg-white"><div class="mt-3"><h3 class="text-lg font-medium text-gray-900 mb-4"> </h3> <form class="space-y-4"><div><label class="block text-sm font-medium text-gray-700 mb-1">Name (English) *</label> <input type="text" required class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="e.g., Main Branch"/></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">Name (Arabic)</label> <input type="text" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="e.g., الفرع الرئيسي"/></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">Contact Number</label> <input type="tel" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="e.g., +966501234567"/></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">Address</label> <textarea rows="2" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Full address..."></textarea></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">Website URL</label> <input type="url" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="https://example.com"/></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">Instagram URL</label> <input type="url" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="https://instagram.com/username"/></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">Snapchat URL</label> <input type="url" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="https://snapchat.com/add/username"/></div> <div class="flex justify-end space-x-2 mt-6"><button type="button" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400">Cancel</button> <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-400"> </button></div></form></div></div></div>'),Oe=m('<div class="fixed bottom-4 right-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded z-50"> </div>'),Qe=m('<div class="fixed bottom-4 right-4 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded z-50"> </div>'),Ve=m('<div class="max-w-7xl mx-auto"><div class="mb-8"><div class="flex justify-between items-center"><div><h1 class="text-3xl font-bold text-gray-900 mb-2">Branch Management</h1> <p class="text-gray-600">Manage all branch locations, contact information, and social media links.</p></div> <button class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">+ Add Branch</button></div></div> <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"><!> <!></div> <!> <!> <!> <!></div>');function dt(ve,me){Ae(me,!1);let X=B([]),f=B(!1),L=B(""),U=B(""),O=B(!1),w=B(null),n=B({name_en:"",name_ar:"",website:"",instagram:"",snapchat:"",contact_number:"",address:""});Ue(()=>{Y()});async function Y(){try{d(f,!0);const{data:a,error:t}=await J.from("branches").select("*").order("name_en");if(t)throw t;const u=await Promise.all((a||[]).map(async _=>{const{count:y}=await J.from("customers").select("*",{count:"exact",head:!0}).eq("nearest_branch_id",_.id);return{..._,customers_count:y||0}}));d(X,u)}catch(a){d(L,`Failed to load branches: ${a.message}`)}finally{d(f,!1)}}function re(){d(w,null),d(n,{name_en:"",name_ar:"",website:"",instagram:"",snapchat:"",contact_number:"",address:""}),d(O,!0)}function be(a){d(w,a),d(n,{name_en:a.name_en,name_ar:a.name_ar||"",website:a.website||"",instagram:a.instagram||"",snapchat:a.snapchat||"",contact_number:a.contact_number||"",address:a.address||""}),d(O,!0)}function se(){d(O,!1),d(w,null),d(L,""),d(U,"")}async function pe(){try{d(f,!0);const a={name_en:e(n).name_en.trim(),name_ar:e(n).name_ar.trim()||null,website:e(n).website.trim()||null,instagram:e(n).instagram.trim()||null,snapchat:e(n).snapchat.trim()||null,contact_number:e(n).contact_number.trim()||null,address:e(n).address.trim()||null};if(e(w)){const{error:t}=await J.from("branches").update(a).eq("id",e(w).id);if(t)throw t;d(U,"Branch updated successfully!")}else{const{error:t}=await J.from("branches").insert(a);if(t)throw t;d(U,"Branch created successfully!")}se(),Y()}catch(a){d(L,`Failed to save branch: ${a.message}`)}finally{d(f,!1)}}async function fe(a){if(confirm(`Are you sure you want to delete "${a.name_en}"? This action cannot be undone.`))try{d(f,!0);const{error:t}=await J.from("branches").delete().eq("id",a.id);if(t)throw t;d(U,"Branch deleted successfully!"),Y()}catch(t){d(L,`Failed to delete branch: ${t.message}`)}finally{d(f,!1)}}function _e(a){try{return new URL(a),!0}catch{return!1}}function Z(a){a&&_e(a)&&window.open(a,"_blank")}Ne();var ee=Ve(),te=r(ee),oe=r(te),ge=o(r(oe),2);s(oe),s(te);var ae=o(te,2),ne=r(ae);ze(ne,1,()=>e(X),De,(a,t)=>{var u=Te(),_=r(u),y=r(_),z=r(y),D=r(z,!0);s(z);var F=o(z,2);{var Q=l=>{var c=Re(),i=r(c,!0);s(c),E(()=>x(i,e(t).name_ar)),v(l,c)};b(F,l=>{e(t).name_ar&&l(Q)})}s(y),ue(2),s(_);var k=o(_,2),N=r(k);{var R=l=>{var c=Se(),i=o(r(c),2),H=r(i,!0);s(i),s(c),E(()=>x(H,e(t).contact_number)),v(l,c)};b(N,l=>{e(t).contact_number&&l(R)})}var V=o(N,2);{var S=l=>{var c=$e(),i=o(r(c),2),H=r(i,!0);s(i),s(c),E(()=>x(H,e(t).address)),v(l,c)};b(V,l=>{e(t).address&&l(S)})}s(k);var $=o(k,2);{var I=l=>{var c=Pe(),i=r(c);{var H=p=>{var h=Ie();g("click",h,()=>Z(e(t).website)),v(p,h)};b(i,p=>{e(t).website&&p(H)})}var ce=o(i,2);{var Ce=p=>{var h=We();g("click",h,()=>Z(e(t).instagram)),v(p,h)};b(ce,p=>{e(t).instagram&&p(Ce)})}var Me=o(ce,2);{var Le=p=>{var h=Ke();g("click",h,()=>Z(e(t).snapchat)),v(p,h)};b(Me,p=>{e(t).snapchat&&p(Le)})}s(c),v(l,c)};b($,l=>{(e(t).website||e(t).instagram||e(t).snapchat)&&l(I)})}var A=o($,2),j=r(A),W=r(j),K=r(W,!0);s(W),ue(2),s(j),s(A);var P=o(A,2),T=r(P),G=o(T,2);s(P),s(u),E(()=>{x(D,e(t).name_en),x(K,e(t).customers_count||0),G.disabled=e(t).customers_count>0}),g("click",T,()=>be(e(t))),g("click",G,()=>fe(e(t))),v(a,u)});var xe=o(ne,2);{var ye=a=>{var t=Ge(),u=o(r(t),6);s(t),g("click",u,re),v(a,t)};b(xe,a=>{e(X).length===0&&!e(f)&&a(ye)})}s(ae);var ie=o(ae,2);{var he=a=>{var t=He();v(a,t)};b(ie,a=>{e(f)&&a(he)})}var de=o(ie,2);{var we=a=>{var t=Je(),u=r(t),_=r(u),y=r(_),z=r(y,!0);s(y);var D=o(y,2),F=r(D),Q=o(r(F),2);q(Q),s(F);var k=o(F,2),N=o(r(k),2);q(N),s(k);var R=o(k,2),V=o(r(R),2);q(V),s(R);var S=o(R,2),$=o(r(S),2);qe($),s(S);var I=o(S,2),A=o(r(I),2);q(A),s(I);var j=o(I,2),W=o(r(j),2);q(W),s(j);var K=o(j,2),P=o(r(K),2);q(P),s(K);var T=o(K,2),G=r(T),l=o(G,2),c=r(l,!0);s(l),s(T),s(D),s(_),s(u),s(t),E(()=>{x(z,e(w)?"Edit Branch":"Create Branch"),l.disabled=e(f),x(c,e(f)?"Saving...":e(w)?"Update":"Create")}),M(Q,()=>e(n).name_en,i=>C(n,e(n).name_en=i)),M(N,()=>e(n).name_ar,i=>C(n,e(n).name_ar=i)),M(V,()=>e(n).contact_number,i=>C(n,e(n).contact_number=i)),M($,()=>e(n).address,i=>C(n,e(n).address=i)),M(A,()=>e(n).website,i=>C(n,e(n).website=i)),M(W,()=>e(n).instagram,i=>C(n,e(n).instagram=i)),M(P,()=>e(n).snapchat,i=>C(n,e(n).snapchat=i)),g("click",G,se),g("submit",D,Fe(pe)),v(a,t)};b(de,a=>{e(O)&&a(we)})}var le=o(de,2);{var ke=a=>{var t=Oe(),u=r(t,!0);s(t),E(()=>x(u,e(L))),v(a,t)};b(le,a=>{e(L)&&a(ke)})}var Be=o(le,2);{var Ee=a=>{var t=Qe(),u=r(t,!0);s(t),E(()=>x(u,e(U))),v(a,t)};b(Be,a=>{e(U)&&a(Ee)})}s(ee),g("click",ge,re),v(ve,ee),je()}export{dt as component};
