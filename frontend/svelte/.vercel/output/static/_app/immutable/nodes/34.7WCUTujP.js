import"../chunks/DsnmJJEf.js";import"../chunks/69_IOA4Y.js";import{o as Qt}from"../chunks/Y1pQyyvi.js";import{t as q,N as Qa,O as Wa,e as Wt,b0 as Xt,a3 as Xa,an as Zt,az as er,b1 as ar,b2 as tr,aM as Za,V as rr,aL as or,am as le,l as sr,q as Y,r as ir,m as M,J as lr,n as S,o as nr,a as e,y as C,s as b,u as d,$ as dr,v as t,z as a,I as te,H as et,C as Ie,w as r,B as l,x as cr,E as T,A as vr,F as ur}from"../chunks/Ck91ypkQ.js";import{i as ne}from"../chunks/RujGBxXx.js";import{e as Pe,i as Ve}from"../chunks/D775oJua.js";import{s as re}from"../chunks/B38bOHRo.js";import{b as pr}from"../chunks/xkiwYR4x.js";import{i as gr}from"../chunks/6tn_K0LM.js";import{s as mr,a as at}from"../chunks/DcXenzi0.js";import{g as Je}from"../chunks/bzBAkz0U.js";import{s as oe}from"../chunks/CIOq__Tp.js";import{g as br}from"../chunks/Bc_wzfnz.js";import{b as tt}from"../chunks/Bt-Xh7oU.js";import{l as fr,t as hr}from"../chunks/DxUIFzZ0.js";function xr(W,X,I=!1,Z=!1,o=!1){var u=W,N="";q(()=>{var E=Wt;if(N===(N=X()??"")){Qa&&Wa();return}if(E.nodes_start!==null&&(Xt(E.nodes_start,E.nodes_end),E.nodes_start=E.nodes_end=null),N!==""){if(Qa){Xa.data;for(var w=Wa(),K=w;w!==null&&(w.nodeType!==Zt||w.data!=="");)K=w,w=er(w);if(w===null)throw ar(),tr;Za(Xa,K),u=rr(w);return}var J=N+"";I?J=`<svg>${J}</svg>`:Z&&(J=`<math>${J}</math>`);var i=or(J);if((I||Z)&&(i=le(i)),Za(le(i),i.lastChild),I||Z)for(;le(i);)u.before(le(i));else u.before(i)}})}function rt(W){const X="/currency-symbol.svg",I=Number(W).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2});return`<img src="${X}" alt="SAR" class="currency-symbol" /> ${I}`}var _r=M('<div class="flex justify-center items-center h-64"><div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"></div></div>'),yr=M('<div class="bg-red-50 border border-red-200 rounded-lg p-4 text-center"><p class="text-red-600"> </p> <button class="mt-2 bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600">Try Again</button></div>'),wr=M("<option> </option>"),Fr=M('<div class="relative group"><div class="absolute -inset-1 bg-gradient-to-r from-gray-200 to-gray-300 rounded-2xl blur opacity-0 group-hover:opacity-30 transition-opacity"></div> <div class="relative p-6 rounded-2xl border border-gray-200 transition-all duration-300 group-hover:border-emerald-300" style="background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(249, 250, 251, 0.9) 100%); backdrop-filter: blur(5px);"><div class="absolute top-0 left-0 w-4 h-4 border-t-2 border-l-2 border-emerald-400 opacity-30"></div> <div class="absolute top-0 right-0 w-4 h-4 border-t-2 border-r-2 border-emerald-400 opacity-30"></div> <div class="grid grid-cols-3 gap-6 items-center"><div class="flex items-center gap-3"><div class="w-10 h-10 rounded-xl flex items-center justify-center" style="background: linear-gradient(135deg, #C0A32A 0%, #D4B836 100%);"><span class="text-white text-lg font-bold">📅</span></div> <div><div class="font-mono text-gray-800 font-semibold"> </div></div></div> <div class="flex items-center gap-3"><div class="w-10 h-10 rounded-xl flex items-center justify-center" style="background: linear-gradient(135deg, #13A538 0%, #77AB39 100%);"><span class="text-white text-lg font-bold">🏪</span></div> <div><div class="font-semibold text-gray-800"> </div></div></div> <div class="flex items-center gap-3 justify-end"><div class="text-right"><div class="text-2xl font-bold font-mono currency-display" style="color: #f08300; text-shadow: 0 0 10px rgba(240, 131, 0, 0.3);"><!></div></div></div></div> <div class="absolute bottom-0 left-0 w-full h-1 bg-gradient-to-r from-emerald-400 via-green-500 to-emerald-400 opacity-20"></div></div></div>'),Ar=M('<div class="space-y-4"></div>'),kr=M('<div class="text-center py-16"><div class="relative"><div class="absolute -inset-4 bg-gradient-to-r from-gray-300 to-gray-400 rounded-3xl blur opacity-20"></div> <div class="relative p-8 rounded-3xl" style="background: linear-gradient(135deg, rgba(243, 244, 246, 0.5) 0%, rgba(249, 250, 251, 0.8) 100%); backdrop-filter: blur(5px); border: 1px solid rgba(156, 163, 175, 0.2);"><div class="w-24 h-24 mx-auto mb-6 rounded-full flex items-center justify-center animate-pulse" style="background: linear-gradient(135deg, #6B7280 0%, #9CA3AF 100%);"><span class="text-4xl">📋</span></div> <h4 class="text-2xl font-bold text-gray-700 mb-3 font-mono"> </h4> <p class="text-gray-500 font-medium"> </p> <div class="flex justify-center gap-2 mt-6"><div class="w-2 h-2 rounded-full bg-gray-400 animate-pulse"></div> <div class="w-2 h-2 rounded-full bg-gray-400 animate-pulse" style="animation-delay: 0.2s;"></div> <div class="w-2 h-2 rounded-full bg-gray-400 animate-pulse" style="animation-delay: 0.4s;"></div></div></div></div></div>'),Dr=M('<div class="flex items-center justify-between p-3 rounded-lg border-2" style="border-color: #77AB39; background: #F3FFF8;"><span class="font-bold text-lg" style="color: #13A538;"> </span> <span class="text-sm text-gray-600"> </span></div>'),Cr=M('<div class="grid md:grid-cols-2 gap-8"><div class="bg-white p-8 rounded-2xl shadow-lg border border-gray-100 hover:shadow-xl transition-all duration-300" style="box-shadow: 0 4px 20px rgba(240, 131, 0, 0.1);"><div class="text-center mb-8"><div class="flex items-center justify-center gap-8 mb-8"><div class="relative group"><div class="absolute -inset-1 bg-gradient-to-r from-emerald-400 via-green-500 to-emerald-600 rounded-2xl blur opacity-25 group-hover:opacity-40 animate-pulse"></div> <div class="relative w-36 h-44 rounded-2xl overflow-hidden" style="background: linear-gradient(135deg, rgba(19, 165, 56, 0.9) 0%, rgba(119, 171, 57, 0.9) 100%); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2);"><div class="absolute inset-0 opacity-10" style="background-image: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(255,255,255,0.1) 2px, rgba(255,255,255,0.1) 4px), repeating-linear-gradient(90deg, transparent, transparent 2px, rgba(255,255,255,0.1) 2px, rgba(255,255,255,0.1) 4px);"></div> <div class="absolute top-0 left-0 w-6 h-6 border-t-2 border-l-2 border-white opacity-50"></div> <div class="absolute top-0 right-0 w-6 h-6 border-t-2 border-r-2 border-white opacity-50"></div> <div class="absolute bottom-0 left-0 w-6 h-6 border-b-2 border-l-2 border-white opacity-50"></div> <div class="absolute bottom-0 right-0 w-6 h-6 border-b-2 border-r-2 border-white opacity-50"></div> <div class="relative z-10 h-full flex flex-col justify-center items-center p-4"><div class="w-2 h-2 rounded-full bg-cyan-400 shadow-lg animate-pulse mb-2" style="box-shadow: 0 0 10px #00ffff;"></div> <div class="text-3xl font-bold text-white mb-2 font-mono tracking-wider" style="text-shadow: 0 0 20px rgba(255,255,255,0.5), 0 0 10px rgba(19,165,56,0.8);"> </div> <div class="text-xs text-white uppercase tracking-widest font-bold opacity-90 px-2 py-1 rounded border border-white border-opacity-30" style="background: rgba(255,255,255,0.1); text-shadow: 0 0 10px rgba(255,255,255,0.8);"> </div> <div class="absolute top-0 left-0 w-full h-0.5 bg-gradient-to-r from-transparent via-cyan-400 to-transparent animate-pulse"></div></div> <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white to-transparent opacity-0 group-hover:opacity-10 transform -skew-x-12 animate-pulse"></div></div></div> <div class="relative group"><div class="absolute -inset-1 bg-gradient-to-r from-orange-400 via-amber-500 to-orange-600 rounded-2xl blur opacity-25 group-hover:opacity-40 animate-pulse"></div> <div class="relative w-36 h-44 rounded-2xl overflow-hidden" style="background: linear-gradient(135deg, rgba(240, 131, 0, 0.9) 0%, rgba(255, 149, 0, 0.9) 100%); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2);"><div class="absolute inset-0 opacity-10" style="background-image: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(255,255,255,0.1) 2px, rgba(255,255,255,0.1) 4px), repeating-linear-gradient(90deg, transparent, transparent 2px, rgba(255,255,255,0.1) 2px, rgba(255,255,255,0.1) 4px);"></div> <div class="absolute top-0 left-0 w-6 h-6 border-t-2 border-l-2 border-white opacity-50"></div> <div class="absolute top-0 right-0 w-6 h-6 border-t-2 border-r-2 border-white opacity-50"></div> <div class="absolute bottom-0 left-0 w-6 h-6 border-b-2 border-l-2 border-white opacity-50"></div> <div class="absolute bottom-0 right-0 w-6 h-6 border-b-2 border-r-2 border-white opacity-50"></div> <div class="relative z-10 h-full flex flex-col justify-center items-center p-4"><div class="w-2 h-2 rounded-full bg-yellow-400 shadow-lg animate-pulse mb-2" style="box-shadow: 0 0 10px #ffff00;"></div> <div class="text-3xl font-bold text-white mb-2 font-mono tracking-wider" style="text-shadow: 0 0 20px rgba(255,255,255,0.5), 0 0 10px rgba(240,131,0,0.8);"> </div> <div class="text-xs text-white uppercase tracking-widest font-bold opacity-90 px-2 py-1 rounded border border-white border-opacity-30" style="background: rgba(255,255,255,0.1); text-shadow: 0 0 10px rgba(255,255,255,0.8);"> </div> <div class="absolute top-0 left-0 w-full h-0.5 bg-gradient-to-r from-transparent via-yellow-400 to-transparent animate-pulse"></div></div> <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white to-transparent opacity-0 group-hover:opacity-10 transform -skew-x-12 animate-pulse"></div></div></div></div> <div class="grid grid-cols-2 gap-6 text-center"><div class="relative group"><div class="absolute -inset-1 bg-gradient-to-r from-emerald-400 to-green-500 rounded-xl blur opacity-20 group-hover:opacity-30 transition-opacity"></div> <div class="relative p-4 rounded-xl border border-emerald-500 border-opacity-30" style="background: linear-gradient(135deg, rgba(19, 165, 56, 0.1) 0%, rgba(119, 171, 57, 0.1) 100%); backdrop-filter: blur(5px);"><div class="w-1.5 h-1.5 rounded-full bg-emerald-400 mx-auto mb-2 animate-pulse" style="box-shadow: 0 0 8px #10b981;"></div> <h3 class="text-lg font-bold mb-2" style="color: #13A538; text-shadow: 0 0 10px rgba(19, 165, 56, 0.5);"> </h3> <p class="text-gray-600 text-sm font-mono opacity-80"> </p></div></div> <div class="relative group"><div class="absolute -inset-1 bg-gradient-to-r from-orange-400 to-amber-500 rounded-xl blur opacity-20 group-hover:opacity-30 transition-opacity"></div> <div class="relative p-4 rounded-xl border border-orange-500 border-opacity-30" style="background: linear-gradient(135deg, rgba(240, 131, 0, 0.1) 0%, rgba(255, 149, 0, 0.1) 100%); backdrop-filter: blur(5px);"><div class="w-1.5 h-1.5 rounded-full bg-orange-400 mx-auto mb-2 animate-pulse" style="box-shadow: 0 0 8px #f97316;"></div> <h3 class="text-lg font-bold mb-2" style="color: #f08300; text-shadow: 0 0 10px rgba(240, 131, 0, 0.5);"> </h3> <p class="text-gray-600 text-sm font-mono opacity-80"> </p></div></div></div></div> <label for="branch-select" style="color: #13A538;"> </label> <select id="branch-select" style="focus:ring-color: #77AB39; focus:border-color: #77AB39;"></select> <p> </p></div> <div class="bg-white p-8 rounded-2xl shadow-lg border border-gray-100 hover:shadow-xl transition-all duration-300"><h3 class="text-2xl font-bold mb-6 text-center" style="color: #13A538;"> </h3> <div class="space-y-4"><a href="/virtual-card" class="block"><div class="flex items-center gap-4 p-4 rounded-xl transition-all duration-300 hover:shadow-md transform hover:scale-[1.02] cursor-pointer" style="background: linear-gradient(135deg, #f08300 0%, #ff9500 100%); color: white;"><div class="text-3xl">💳</div> <div class="flex-1"><h4 class="font-bold text-lg"> </h4> <p class="text-orange-100 text-sm"> </p></div> <div class="text-2xl opacity-70">→</div></div></a> <a href="/customer-support" class="block"><div style="background: linear-gradient(135deg, #13A538 0%, #77AB39 100%); color: white;"><div class="text-3xl">💬</div> <div class="flex-1"><h4 class="font-bold text-lg"> </h4> <p class="text-green-100 text-sm"> </p></div> <div class="text-2xl opacity-70">→</div></div></a> <a href="/my-offers" class="block"><div style="background: linear-gradient(135deg, #C0A32A 0%, #D4B836 100%); color: white;"><div class="text-3xl">🎁</div> <div class="flex-1"><h4 class="font-bold text-lg"> </h4> <p class="text-yellow-100 text-sm"> </p></div> <div class="text-2xl opacity-70">→</div></div></a></div></div></div> <section class="relative mt-8"><div class="absolute -inset-1 bg-gradient-to-r from-green-400 via-emerald-500 to-green-600 rounded-3xl blur opacity-20 animate-pulse"></div> <div class="relative bg-white rounded-3xl shadow-2xl border border-gray-100 overflow-hidden" style="backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2);"><div class="relative p-8 pb-6" style="background: linear-gradient(135deg, rgba(19, 165, 56, 0.05) 0%, rgba(119, 171, 57, 0.05) 100%);"><div class="absolute inset-0 opacity-5" style="background-image: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(19,165,56,0.2) 2px, rgba(19,165,56,0.2) 4px), repeating-linear-gradient(90deg, transparent, transparent 2px, rgba(19,165,56,0.2) 2px, rgba(19,165,56,0.2) 4px);"></div> <div class="relative flex justify-between items-center"><div class="flex items-center gap-4"><div class="w-3 h-3 rounded-full bg-emerald-400 animate-pulse" style="box-shadow: 0 0 15px #10b981;"></div> <h3 class="text-3xl font-bold font-mono tracking-wide" style="color: #13A538; text-shadow: 0 0 20px rgba(19, 165, 56, 0.3);"> </h3></div></div> <div class="absolute bottom-0 left-0 w-full h-0.5 bg-gradient-to-r from-transparent via-emerald-400 to-transparent animate-pulse"></div></div> <div class="p-6"><!></div> <div class="h-1 bg-gradient-to-r from-transparent via-emerald-400 to-transparent"></div></div></section> <section class="bg-white rounded-2xl shadow-lg border border-gray-100 p-8 mt-8"><div class="flex items-center gap-3 mb-6"><div class="w-12 h-12 rounded-full flex items-center justify-center" style="background: linear-gradient(135deg, #C0A32A 0%, #D4B836 100%);"><span class="text-2xl">🎯</span></div> <div><h3 class="text-2xl font-bold" style="color: #C0A32A;"> </h3> <p class="text-gray-600 text-sm"> </p></div></div> <div class="grid md:grid-cols-2 gap-6"><div class="space-y-4"><h4 class="font-bold text-lg" style="color: #13A538;"> </h4> <div class="grid grid-cols-2 gap-3"></div></div> <div class="space-y-4"><h4 class="font-bold text-lg" style="color: #f08300;"> </h4> <div class="space-y-3"><div class="flex items-start gap-3 p-3 rounded-lg" style="background: #FFF8F0; border: 1px solid #f08300;"><span class="text-lg">⚠️</span> <div class="flex-1 text-sm"><p class="font-medium text-gray-800"> </p> <p class="text-gray-600 mt-1"> </p></div></div> <div class="flex items-start gap-3 p-3 rounded-lg" style="background: #FFF8F0; border: 1px solid #f08300;"><span class="text-lg">💸</span> <div class="flex-1 text-sm"><p class="font-medium text-gray-800"> </p> <p class="text-gray-600 mt-1"> </p></div></div> <div class="flex items-start gap-3 p-3 rounded-lg" style="background: #F3FFF8; border: 1px solid #77AB39;"><span class="text-lg">✅</span> <div class="flex-1 text-sm"><p class="font-medium text-gray-800"> </p> <p class="text-gray-600 mt-1"> </p></div></div></div></div></div> <div class="mt-6 p-4 rounded-xl text-center" style="background: linear-gradient(135deg, #EAFBEF 0%, #F3FFF8 100%); border: 2px solid #77AB39;"><p class="text-gray-700 mb-3"><span class="font-bold" style="color: #13A538;"> </span></p> <p class="text-sm text-gray-600 mb-4"> </p> <a href="/customer-support" class="inline-flex items-center gap-2 text-white px-6 py-3 rounded-xl font-bold transition-all duration-300 transform hover:scale-[1.02] shadow-lg hover:shadow-xl" style="background: #13A538;"><span class="text-xl">💬</span> <span> </span></a></div></section>',1),Er=M('<main class="p-6 max-w-6xl mx-auto mt-8"><!></main>');function Jr(W,X){sr(X,!1);const[I,Z]=mr(),o=()=>at(hr,"$t",I),u=()=>at(fr,"$language",I),N=C(),E=C(),w=C(),K=C(),J=C();let i=C("all"),n=C(null),P=C(null),F=C([]),B=C([]),p=C([]),A=C(!0),$=C("");function ot(s){if(!e(p)||s==="all")return Ge();const c=e(p).filter(m=>m.branch_id?m.branch_id?.toString()===s.toString():!1),f=c.reduce((m,x)=>m+(parseFloat(x.add_amt)||0),0),g=c.reduce((m,x)=>m+(parseFloat(x.redeem)||0),0);return parseFloat((f-g).toFixed(2))}function st(s){if(!e(p)||s==="all")return ze();const f=e(p).filter(g=>g.branch_id?g.branch_id?.toString()===s.toString():!1).reduce((g,m)=>g+(parseFloat(m.add_amt)||0),0);return parseFloat(f.toFixed(2))}function ze(){if(console.log("🎯 calculateTotalLifetimeEarned called:",{hasAllTransactions:!!e(p),allTransactionsLength:e(p)?.length||0,hasCustomerData:!!e(n),customerLifetimeEarned:e(n)?.lifetime_earned,isLoading:e(A)}),!e(p)||e(p).length===0){const c=e(n)?.lifetime_earned||0;return console.log("🎯 Using fallback lifetime earned:",c),c}const s=e(p).reduce((c,f)=>c+(parseFloat(f.add_amt)||0),0);return console.log("🎯 Total Lifetime Earned Calculation:",{totalLifetimeEarned:s,transactionsCount:e(p).length,customerLifetimeEarned:e(n)?.lifetime_earned}),parseFloat(s.toFixed(2))}function Ge(){if(console.log("💰 calculateCurrentBalance called:",{hasAllTransactions:!!e(p),allTransactionsLength:e(p)?.length||0,hasCustomerData:!!e(n),customerTotalPoints:e(n)?.total_points,isLoading:e(A)}),!e(p)||e(p).length===0){const g=e(n)?.total_points||0;return console.log("💰 Using fallback balance:",g),g}const s=e(p).reduce((g,m)=>g+(parseFloat(m.add_amt)||0),0),c=e(p).reduce((g,m)=>g+(parseFloat(m.redeem)||0),0),f=s-c;return console.log("💰 Current Balance Calculation:",{totalAddAmt:s,totalRedeem:c,currentBalance:f,transactionsCount:e(p).length}),parseFloat(f.toFixed(2))}async function it(){if(e(n)?.customer_code)try{let s=oe.from("customer_transactions").select(`
          *,
          branches (
            name,
            name_ar
          )
        `).or(`customer_code.eq.${e(n).customer_code},customer_mobile.eq.${e(n).customer_code}`).order("bill_date",{ascending:!1}).order("created_at",{ascending:!1});if(e(i)!=="all"){const g=isNaN(Number(e(i)))?e(i):parseInt(e(i));s=s.eq("branch_id",g)}const{data:c,error:f}=await s.limit(5);f?console.warn("⚠️ Dashboard: Error fetching filtered transactions:",f):(b(B,c||[]),console.log(`✅ Dashboard: Filtered transactions loaded for branch ${e(i)}:`,e(B).length,e(B)))}catch(s){console.error("💥 Dashboard: Error loading filtered transactions:",s)}}async function He(){try{b(A,!0),b($,"");const s=JSON.parse(localStorage.getItem("loyaltyUser")||"{}");if(console.log("🔍 Dashboard: Current user from localStorage:",s),!s.mobile){b($,o().noUserFound),console.log("❌ Dashboard: No mobile found in localStorage"),tt&&br("/login");return}console.log("🔍 Dashboard: Fetching customer data for mobile:",s.mobile);const{data:c,error:f}=await oe.from("customers").select(`
          *,
          card_types (
            name,
            name_ar,
            color,
            point_limit
          )
        `).eq("customer_code",s.mobile).single();if(f){console.error("❌ Dashboard: Error fetching customer:",f),b($,`Failed to load customer data: ${f.message}`);return}if(!c){console.log("❌ Dashboard: No customer found for mobile:",s.mobile),b($,o().customerNotFound);return}console.log("✅ Dashboard: Customer data loaded:",c),b(n,c),b(P,c.card_types),console.log("✅ Dashboard: Card type data:",e(P)),b($,""),console.log("🔍 Dashboard: Fetching branches...");const{data:g,error:m}=await oe.from("branches").select("id, name, name_en, name_ar").order("name");m?(console.warn("⚠️ Dashboard: Error fetching branches:",m),b(F,[])):(b(F,g||[]),console.log("✅ Dashboard: Branches loaded:",e(F).length)),console.log("🔍 Dashboard: Fetching transactions for customer_code:",c.customer_code);const{data:x,error:D}=await oe.from("customer_transactions").select(`
          *,
          branches (
            name,
            name_ar
          )
        `).or(`customer_code.eq.${c.customer_code},customer_mobile.eq.${c.customer_code}`).order("bill_date",{ascending:!1}).order("created_at",{ascending:!1}).limit(5);D?(console.warn("⚠️ Dashboard: Error fetching transactions:",D),b(B,[])):(b(B,x||[]),console.log("✅ Dashboard: Transactions loaded:",e(B).length,e(B))),console.log("🔍 Dashboard: Fetching all transactions for lifetime points...");const{data:V,error:z}=await oe.from("customer_transactions").select(`
          points_earned,
          points_redeemed,
          branch_id,
          amount,
          add_amt,
          redeem,
          bill_date,
          created_at,
          customer_code,
          customer_mobile,
          bill_no
        `).or(`customer_code.eq.${c.customer_code},customer_mobile.eq.${c.customer_code}`);if(console.log("🔍 Dashboard: Transaction query for customer:",c.customer_code),console.log("🔍 Dashboard: All transactions result:",{allTransactionsData:V,allTransactionsError:z}),z)console.warn("⚠️ Dashboard: Error fetching all transactions:",z),te(n,e(n).lifetime_earned=e(n).total_points||0),te(n,e(n).lifetime_points=e(n).total_points||0),b(p,[]);else{b(p,V||[]);const R=e(p).reduce((L,U)=>L+(parseFloat(U.add_amt)||0),0),ee=e(p).reduce((L,U)=>L+(U.points_earned||0),0),Q=e(p).reduce((L,U)=>L+(parseFloat(U.redeem)||0),0);te(n,e(n).lifetime_earned=R),te(n,e(n).lifetime_points=ee);const G=R-Q;(!e(n).total_points||e(n).total_points===0)&&G>0&&te(n,e(n).total_points=G),console.log("✅ Dashboard: Points Summary:",{lifetimeEarned:R,lifetimePoints:ee,totalRedeemed:Q,calculatedBalance:G,customerStoredBalance:e(n).total_points,transactionCount:e(p).length}),console.log("✅ Dashboard: All transactions:",e(p)),b(p,[...e(p)])}}catch(s){console.error("💥 Dashboard: Unexpected error:",s),b($,`Unexpected error: ${s}`)}finally{b(A,!1),console.log("🏁 Dashboard: Loading completed. Error:",e($))}}Qt(()=>{He()});function lt(s,c){const f=parseInt(s.replace("#",""),16),g=Math.round(2.55*c),m=(f>>16)+g,x=(f>>8&255)+g,D=(f&255)+g;return"#"+(16777216+(m<255?m<1?0:m:255)*65536+(x<255?x<1?0:x:255)*256+(D<255?D<1?0:D:255)).toString(16).slice(1)}function nt(s){if(!s)return u()==="ar"?"غير متاح":"Not Available";try{const c=new Date(s),f=u()==="ar"?["يناير","فبراير","مارس","أبريل","مايو","يونيو","يوليو","أغسطس","سبتمبر","أكتوبر","نوفمبر","ديسمبر"]:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],g=c.getDate(),m=f[c.getMonth()],x=c.getFullYear();return u()==="ar"?`${g} ${m} ${x}`:`${g} ${m} ${x}`}catch{return u()==="ar"?"غير متاح":"Not Available"}}Y(()=>(e(i),e(B)),()=>{b(N,e(i)==="all"?e(B):e(B).filter(s=>s.branch_id?.toString()===e(i).toString()))}),Y(()=>(e(A),e(n),e(i)),()=>{b(E,e(A)||!e(n)?0:e(i)==="all"?Ge():ot(e(i)))}),Y(()=>(e(A),e(n),e(i)),()=>{b(w,e(A)||!e(n)?0:e(i)==="all"?ze():st(e(i)))}),Y(()=>(e(n),e(i),e(E),e(w),e(p),e(A)),()=>{e(n)&&console.log("🔄 Enhanced Reactive Update:",{selectedBranch:e(i),currentBalance:e(E),lifetimeEarned:e(w),allTransactionsLength:e(p)?.length||0,customerTotalPoints:e(n).total_points,customerLifetimeEarned:e(n).lifetime_earned,hasAllTransactions:!!e(p),hasCustomerData:!!e(n),isLoading:e(A)})}),Y(()=>(e(i),e(n)),()=>{e(i)&&e(n)&&it()}),Y(()=>(u(),e(F)),()=>{b(K,[{id:"all",name:u()==="ar"?"جميع الفروع":"All Branches"},...e(F).map(s=>({id:s.id,name:u()==="ar"?s.name_ar||s.name_en||s.name||"Unknown":s.name_en||s.name||s.name_ar||"Unknown"}))])}),Y(()=>(e(P),Je),()=>{b(J,(()=>{try{if(e(P)&&e(P).color){const s=e(P).color;return{from:s,to:lt(s,-20)}}return e(P)?Je(e(P).name):Je("Gold")}catch(s){return console.warn("Failed to get card gradient, using default:",s),{from:"#FFD700",to:"#FFA500"}}})())}),ir(),gr();var de=Er();lr(s=>{q(()=>dr.title=`${o(),d(()=>o().dashboard)??""} - Urban Market Loyalty`)});var dt=t(de);{var ct=s=>{var c=_r();S(s,c)},vt=s=>{var c=et(),f=Ie(c);{var g=x=>{var D=yr(),V=t(D),z=t(V,!0);a(V);var R=r(V,2);a(D),q(()=>l(z,e($))),cr("click",R,He),S(x,D)},m=x=>{var D=et(),V=Ie(D);{var z=R=>{var ee=Cr(),Q=Ie(ee),G=t(Q),L=t(G),U=t(L),ce=t(U),Ye=r(t(ce),2),Ke=r(t(Ye),10),ve=r(t(Ke),2),ut=t(ve,!0);a(ve);var Qe=r(ve,2),pt=t(Qe,!0);a(Qe),T(2),a(Ke),T(2),a(Ye),a(ce);var We=r(ce,2),Xe=r(t(We),2),Ze=r(t(Xe),10),ue=r(t(Ze),2),gt=t(ue,!0);a(ue);var ea=r(ue,2),mt=t(ea,!0);a(ea),T(2),a(Ze),T(2),a(Xe),a(We),a(U);var aa=r(U,2),pe=t(aa),ta=r(t(pe),2),ge=r(t(ta),2),bt=t(ge,!0);a(ge);var ra=r(ge,2),ft=t(ra,!0);a(ra),a(ta),a(pe);var oa=r(pe,2),sa=r(t(oa),2),me=r(t(sa),2),ht=t(me,!0);a(me);var ia=r(me,2),xt=t(ia,!0);a(ia),a(sa),a(oa),a(aa),a(L);var se=r(L,2);let la;var _t=t(se,!0);a(se);var ae=r(se,2);q(()=>{e(i),vr(()=>{u(),e(K)})});let na;Pe(ae,5,()=>e(K),Ve,(v,_)=>{var y=wr(),h=t(y,!0);a(y);var k={};q(()=>{l(h,(e(_),d(()=>e(_).name))),k!==(k=(e(_),d(()=>e(_).id)))&&(y.value=(y.__value=(e(_),d(()=>e(_).id)))??"")}),S(v,y)}),a(ae);var be=r(ae,2);let da;var yt=t(be,!0);a(be),a(G);var ca=r(G,2),fe=t(ca),wt=t(fe,!0);a(fe);var va=r(fe,2),he=t(va),ua=t(he),pa=r(t(ua),2),xe=t(pa),Ft=t(xe,!0);a(xe);var ga=r(xe,2),At=t(ga,!0);a(ga),a(pa),T(2),a(ua),a(he);var _e=r(he,2),ye=t(_e);let ma;var ba=r(t(ye),2),we=t(ba),kt=t(we,!0);a(we);var fa=r(we,2),Dt=t(fa,!0);a(fa),a(ba),T(2),a(ye),a(_e);var ha=r(_e,2),Fe=t(ha);let xa;var _a=r(t(Fe),2),Ae=t(_a),Ct=t(Ae,!0);a(Ae);var ya=r(Ae,2),Et=t(ya,!0);a(ya),a(_a),T(2),a(Fe),a(ha),a(va),a(ca),a(Q);var ke=r(Q,2),wa=r(t(ke),2),De=t(wa),Fa=r(t(De),2),Aa=t(Fa),ka=r(t(Aa),2),St=t(ka,!0);a(ka),a(Aa),a(Fa),T(2),a(De);var Da=r(De,2),Tt=t(Da);{var Bt=v=>{var _=Ar();Pe(_,5,()=>e(N),Ve,(y,h)=>{var k=Fr(),O=r(t(k),2),j=r(t(O),4),H=t(j),ie=r(t(H),2),Ja=t(ie),Gt=t(Ja,!0);a(Ja),a(ie),a(H);var Me=r(H,2),za=r(t(Me),2),Ga=t(za),Ht=t(Ga,!0);a(Ga),a(za),a(Me);var Ha=r(Me,2),Ya=t(Ha),Ka=t(Ya),Yt=t(Ka);xr(Yt,()=>(ur(rt),e(h),d(()=>rt(e(h).amount||0)))),a(Ka),a(Ya),a(Ha),a(j),T(2),a(O),a(k),q(Kt=>{l(Gt,Kt),l(Ht,(u(),e(h),d(()=>u()==="ar"?e(h).branches?.name_ar||e(h).branches?.name||"غير متاح":e(h).branches?.name||"N/A")))},[()=>(e(h),d(()=>nt(e(h).bill_date||e(h).created_at)))]),S(y,k)}),a(_),S(v,_)},Nt=v=>{var _=kr(),y=t(_),h=r(t(y),2),k=r(t(h),2),O=t(k,!0);a(k);var j=r(k,2),H=t(j,!0);a(j),T(2),a(h),a(y),a(_),q(()=>{l(O,u()==="ar"?"لا توجد معاملات":"NO TRANSACTIONS FOUND"),l(H,e(i)==="all"?u()==="ar"?"ابدأ التسوق لرؤية معاملاتك هنا":"Start shopping to see your transactions here":u()==="ar"?"لا توجد معاملات لهذا الفرع":"No transactions found for this branch")}),S(v,_)};ne(Tt,v=>{e(N),d(()=>e(N).length>0)?v(Bt):v(Nt,!1)})}a(Da),T(2),a(wa),a(ke);var Ca=r(ke,2),Ce=t(Ca),Ea=r(t(Ce),2),Ee=t(Ea),$t=t(Ee,!0);a(Ee);var Sa=r(Ee,2),Rt=t(Sa,!0);a(Sa),a(Ea),a(Ce);var Se=r(Ce,2),Te=t(Se),Be=t(Te),Lt=t(Be,!0);a(Be);var Ta=r(Be,2);Pe(Ta,4,()=>[50,100,150,200],Ve,(v,_)=>{var y=Dr(),h=t(y),k=t(h,!0);a(h);var O=r(h,2),j=t(O,!0);a(O),a(y),q(()=>{l(k,_),l(j,(o(),d(()=>o().points||"Points")))}),S(v,y)}),a(Ta),a(Te);var Ba=r(Te,2),Ne=t(Ba),Ut=t(Ne,!0);a(Ne);var Na=r(Ne,2),$e=t(Na),$a=r(t($e),2),Re=t($a),Ot=t(Re,!0);a(Re);var Ra=r(Re,2),jt=t(Ra,!0);a(Ra),a($a),a($e);var Le=r($e,2),La=r(t(Le),2),Ue=t(La),qt=t(Ue,!0);a(Ue);var Ua=r(Ue,2),Mt=t(Ua,!0);a(Ua),a(La),a(Le);var Oa=r(Le,2),ja=r(t(Oa),2),Oe=t(ja),It=t(Oe,!0);a(Oe);var qa=r(Oe,2),Pt=t(qa,!0);a(qa),a(ja),a(Oa),a(Na),a(Ba),a(Se);var Ma=r(Se,2),je=t(Ma),Ia=t(je),Vt=t(Ia,!0);a(Ia),a(je);var qe=r(je,2),Jt=t(qe,!0);a(qe);var Pa=r(qe,2),Va=r(t(Pa),2),zt=t(Va,!0);a(Va),a(Pa),a(Ma),a(Ca),q((v,_,y,h,k,O,j,H,ie)=>{l(ut,v),l(pt,u()==="ar"?"الحالي":"CURRENT"),l(gt,_),l(mt,u()==="ar"?"مدى الحياة":"LIFETIME"),l(bt,(o(),d(()=>o().yourBalance))),l(ft,y),l(ht,(o(),d(()=>o().lifetimeEarned))),l(xt,h),la=re(se,1,"text-sm font-bold uppercase tracking-wide mb-3 block",null,la,k),l(_t,(o(),d(()=>o().filterTransactions))),na=re(ae,1,"px-4 py-3 border-2 border-gray-200 rounded-xl w-full bg-white mt-2 focus:ring-2 focus:border-transparent transition-all shadow-sm hover:border-gray-300",null,na,O),da=re(be,1,"text-xs text-gray-500 mt-2",null,da,j),l(yt,(o(),d(()=>o().filterNote))),l(wt,(o(),d(()=>o().quickActions))),l(Ft,(o(),d(()=>o().virtualCard))),l(At,(o(),d(()=>o().viewYourCard))),ma=re(ye,1,"flex items-center gap-4 p-4 rounded-xl transition-all duration-300 hover:shadow-md transform hover:scale-[1.02] cursor-pointer",null,ma,H),l(kt,(o(),d(()=>o().customerSupport))),l(Dt,(o(),d(()=>o().needHelp))),xa=re(Fe,1,"flex items-center gap-4 p-4 rounded-xl transition-all duration-300 hover:shadow-md transform hover:scale-[1.02] cursor-pointer",null,xa,ie),l(Ct,(o(),d(()=>o().myOffers))),l(Et,(o(),d(()=>o().viewSpecialOffers))),l(St,u()==="ar"?"المعاملات الأخيرة":"RECENT TRANSACTIONS"),l($t,(o(),d(()=>o().redemptionConditions||"Point Redemption Conditions"))),l(Rt,(o(),d(()=>o().redemptionRules||"Important rules for using your points"))),l(Lt,(o(),d(()=>o().allowedRedemptions||"Allowed Redemption Values"))),l(Ut,(o(),d(()=>o().importantRules||"Important Rules"))),l(Ot,(o(),d(()=>o().noCustomValues||"No Custom Values Allowed"))),l(jt,(o(),d(()=>o().noCustomValuesDesc||"Points can only be redeemed in the specified amounts: 50, 100, 150, or 200 points."))),l(qt,(o(),d(()=>o().noCashExchange||"No Cash Exchange"))),l(Mt,(o(),d(()=>o().noCashExchangeDesc||"Points cannot be converted to cash. They can only be used for discounts on purchases."))),l(It,(o(),d(()=>o().storeUseOnly||"Store Use Only"))),l(Pt,(o(),d(()=>o().storeUseOnlyDesc||"Points can be used for discounts on future purchases at Urban Market stores."))),l(Vt,(o(),d(()=>o().readyToRedeem||"Ready to redeem your points?"))),l(Jt,(o(),d(()=>o().contactStoreStaff||"Contact store staff during your next visit or reach out to customer support for assistance with point redemption."))),l(zt,(o(),d(()=>o().contactSupport||"Contact Support")))},[()=>(e(A),e(E),d(()=>e(A)?"...":e(E).toFixed(2))),()=>(e(A),e(w),d(()=>e(A)?"...":e(w).toFixed(2))),()=>(e(i),o(),u(),e(F),d(()=>e(i)==="all"?o().totalAvailable:u()==="ar"?e(F).find(v=>v.id.toString()===e(i))?.name_ar||e(F).find(v=>v.id.toString()===e(i))?.name_en||"Selected Branch":e(F).find(v=>v.id.toString()===e(i))?.name_en||e(F).find(v=>v.id.toString()===e(i))?.name||"Selected Branch")),()=>(e(i),o(),u(),e(F),d(()=>e(i)==="all"?o().totalAmountEarned:u()==="ar"?e(F).find(v=>v.id.toString()===e(i))?.name_ar||e(F).find(v=>v.id.toString()===e(i))?.name_en||"Selected Branch":e(F).find(v=>v.id.toString()===e(i))?.name_en||e(F).find(v=>v.id.toString()===e(i))?.name||"Selected Branch")),()=>({"text-right":u()==="ar"}),()=>({"text-right":u()==="ar"}),()=>({"text-right":u()==="ar"}),()=>({"flex-row-reverse":u()==="ar"}),()=>({"flex-row-reverse":u()==="ar"})]),pr(ae,()=>e(i),v=>b(i,v)),S(R,ee)};ne(V,R=>{e(n)&&R(z)},!0)}S(x,D)};ne(f,x=>{e($)?x(g):x(m,!1)},!0)}S(s,c)};ne(dt,s=>{e(A)?s(ct):s(vt,!1)})}a(de),S(W,de),nr(),Z()}export{Jr as component};
