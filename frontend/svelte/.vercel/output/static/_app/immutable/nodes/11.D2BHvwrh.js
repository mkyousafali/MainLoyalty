import"../chunks/DsnmJJEf.js";import"../chunks/69_IOA4Y.js";import{o as Fe}from"../chunks/Y1pQyyvi.js";import{l as Me,q as Pe,r as qe,m as y,t as b,v as r,w as s,a as t,x as f,n as _,o as Ne,y as p,s as l,z as e,A as pt,B as c,u as v,H as ze,C as ie,I as U,E as le}from"../chunks/Ck91ypkQ.js";import{i as Y}from"../chunks/RujGBxXx.js";import{e as bt,i as mt}from"../chunks/D775oJua.js";import{r as Z}from"../chunks/DvH4tfbe.js";import{s as Qt}from"../chunks/B38bOHRo.js";import{s as Ie}from"../chunks/CNyBBxAM.js";import{a as T}from"../chunks/C4HntxLm.js";import{b as _t}from"../chunks/xkiwYR4x.js";import{i as je}from"../chunks/6tn_K0LM.js";import{s as xt}from"../chunks/CIOq__Tp.js";var De=y("<option> </option>"),Le=y("<option> </option>"),Re=y('<div class="p-8 text-center"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"></div> <p class="text-gray-600 mt-2">Loading customers...</p></div>'),He=y('<div class="p-8 text-center text-gray-500">No customers found matching your criteria.</div>'),Je=y('<tr class="hover:bg-gray-50"><td class="px-6 py-4 whitespace-nowrap text-sm font-mono text-gray-900"> </td><td class="px-6 py-4 whitespace-nowrap"><div class="text-sm font-medium text-gray-900"> </div> <div class="text-sm text-gray-500"> </div></td><td class="px-6 py-4 whitespace-nowrap"><span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full"> </span></td><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 font-medium"> </td><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"> </td><td class="px-6 py-4 whitespace-nowrap"><span> </span></td><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"> </td><td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2"><button class="text-blue-600 hover:text-blue-900">Edit</button> <button> </button></td></tr>'),Oe=y("<button></button>"),Ue=y('<div class="bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6"><div class="flex-1 flex justify-between sm:hidden"><button class="relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:bg-gray-100 disabled:cursor-not-allowed">Previous</button> <button class="ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:bg-gray-100 disabled:cursor-not-allowed">Next</button></div> <div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between"><div><p class="text-sm text-gray-700">Showing <span class="font-medium"> </span> to <span class="font-medium"> </span> of <span class="font-medium"> </span> results</p></div> <div><nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px"></nav></div></div></div>'),Ve=y('<div class="overflow-x-auto"><table class="min-w-full divide-y divide-gray-200"><thead class="bg-gray-50"><tr><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer"> </th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer"> </th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Card Type</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer"> </th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Branch</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer"> </th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th></tr></thead><tbody class="bg-white divide-y divide-gray-200"></tbody></table></div> <!>',1),Ge=y("<option> </option>"),Ke=y('<div class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"><div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white"><div class="mt-3"><h3 class="text-lg font-medium text-gray-900 mb-4">Edit Customer</h3> <div class="space-y-4"><div><label class="block text-sm font-medium text-gray-700 mb-1">Name</label> <input type="text" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"/></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">Email</label> <input type="email" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"/></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">Area</label> <input type="text" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"/></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">Points</label> <input type="number" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"/></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">Card Type</label> <select class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"></select></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">Status</label> <select class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"><option>Active</option><option>Inactive</option><option>Blocked</option></select></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">Valid Until</label> <input type="date" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"/></div></div> <div class="flex justify-end space-x-2 mt-6"><button class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400">Cancel</button> <button class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-400"> </button></div></div></div></div>'),Qe=y('<div class="fixed bottom-4 right-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded z-50"> </div>'),We=y('<div class="fixed bottom-4 right-4 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded z-50"> </div>'),Xe=y('<div class="max-w-7xl mx-auto"><div class="mb-8"><h1 class="text-3xl font-bold text-gray-900 mb-2">Customer Management</h1> <p class="text-gray-600">Search, filter, and manage customer accounts, points, and status.</p></div> <div class="bg-white rounded-lg shadow p-6 mb-6"><h2 class="text-lg font-semibold mb-4">Search & Filters</h2> <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4"><div><label class="block text-sm font-medium text-gray-700 mb-2">Search</label> <input type="text" placeholder="Mobile, name, or email..." class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"/></div> <div><label class="block text-sm font-medium text-gray-700 mb-2">Branch</label> <select class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"><option>All Branches</option><!></select></div> <div><label class="block text-sm font-medium text-gray-700 mb-2">Card Type</label> <select class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"><option>All Card Types</option><!></select></div> <div><label class="block text-sm font-medium text-gray-700 mb-2">Status</label> <select class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"><option>All Statuses</option><option>Active</option><option>Inactive</option><option>Blocked</option></select></div></div> <div class="flex gap-4"><button class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">Apply Filters</button> <button class="bg-gray-600 text-white px-6 py-2 rounded-lg hover:bg-gray-700">Clear Filters</button></div></div> <div class="bg-white rounded-lg shadow overflow-hidden"><div class="px-6 py-4 border-b border-gray-200"><h2 class="text-lg font-semibold"> </h2></div> <!></div> <!> <!> <!></div>');function va(de,ne){Me(ne,!1);const tt=p();let gt=p([]),At=p([]),et=p([]),P=p(!1),q=p(""),at=p(""),N=p(""),V=p(""),G=p(""),K=p(""),z=p("created_at"),A=p("desc"),h=p(1),rt=20,I=p(0),d=p(null),Bt=p(!1);Fe(()=>{ve(),j()});async function ve(){try{const[a,o]=await Promise.all([xt.from("branches").select("*").order("name_en"),xt.from("card_types").select("*").order("point_limit")]);l(At,a.data||[]),l(et,o.data||[])}catch(a){l(q,`Failed to load initial data: ${a.message}`)}}async function j(){try{l(P,!0);let a=xt.from("customers").select(`
          *,
          branches!nearest_branch_id(name_en),
          card_types(name_en, color)
        `,{count:"exact"});t(N)&&(a=a.or(`customer.ilike.%${t(N)}%,name.ilike.%${t(N)}%,email.ilike.%${t(N)}%`)),t(V)&&(a=a.eq("nearest_branch_id",t(V))),t(G)&&(a=a.eq("card_type_id",t(G))),t(K)&&(a=a.eq("status",t(K))),a=a.order(t(z),{ascending:t(A)==="asc"});const o=(t(h)-1)*rt,n=o+rt-1;a=a.range(o,n);const{data:C,error:m,count:w}=await a;if(m)throw m;l(gt,C||[]),l(I,w||0)}catch(a){l(q,`Failed to load customers: ${a.message}`)}finally{l(P,!1)}}function ce(a){l(d,{...a}),l(Bt,!0)}function Wt(){l(d,null),l(Bt,!1),l(q,""),l(at,"")}async function ue(){try{l(P,!0);const{error:a}=await xt.from("customers").update({name:t(d).name,email:t(d).email,area:t(d).area,points:parseInt(t(d).points),status:t(d).status,valid_until:t(d).valid_until,card_type_id:t(d).card_type_id}).eq("id",t(d).id);if(a)throw a;l(at,"Customer updated successfully!"),Wt(),j()}catch(a){l(q,`Failed to update customer: ${a.message}`)}finally{l(P,!1)}}async function pe(a){try{const o=a.status==="active"?"blocked":"active",{error:n}=await xt.from("customers").update({status:o}).eq("id",a.id);if(n)throw n;l(at,`Customer ${o==="active"?"activated":"blocked"} successfully!`),j()}catch(o){l(q,`Failed to update customer status: ${o.message}`)}}function ft(a){t(z)===a?l(A,t(A)==="asc"?"desc":"asc"):(l(z,a),l(A,"asc")),j()}function Et(a){l(h,a),j()}function be(){l(h,1),j()}function me(){l(N,""),l(V,""),l(G,""),l(K,""),l(h,1),j()}Pe(()=>t(I),()=>{l(tt,Math.ceil(t(I)/rt))}),qe(),je();var Ft=Xe(),Mt=s(r(Ft),2),Pt=s(r(Mt),2),qt=r(Pt),Xt=s(r(qt),2);Z(Xt),e(qt);var Nt=s(qt,2),zt=s(r(Nt),2);b(()=>{t(V),pt(()=>{t(At)})});var It=r(zt);It.value=It.__value="";var _e=s(It);bt(_e,1,()=>t(At),mt,(a,o)=>{var n=De(),C=r(n,!0);e(n);var m={};b(()=>{c(C,(t(o),v(()=>t(o).name_en))),m!==(m=(t(o),v(()=>t(o).id)))&&(n.value=(n.__value=(t(o),v(()=>t(o).id)))??"")}),_(a,n)}),e(zt),e(Nt);var jt=s(Nt,2),Dt=s(r(jt),2);b(()=>{t(G),pt(()=>{t(et)})});var Lt=r(Dt);Lt.value=Lt.__value="";var xe=s(Lt);bt(xe,1,()=>t(et),mt,(a,o)=>{var n=Le(),C=r(n,!0);e(n);var m={};b(()=>{c(C,(t(o),v(()=>t(o).name_en))),m!==(m=(t(o),v(()=>t(o).id)))&&(n.value=(n.__value=(t(o),v(()=>t(o).id)))??"")}),_(a,n)}),e(Dt),e(jt);var Yt=s(jt,2),Rt=s(r(Yt),2);b(()=>{t(K),pt(()=>{})});var Ht=r(Rt);Ht.value=Ht.__value="";var Jt=s(Ht);Jt.value=Jt.__value="active";var Ot=s(Jt);Ot.value=Ot.__value="inactive";var Zt=s(Ot);Zt.value=Zt.__value="blocked",e(Rt),e(Yt),e(Pt);var Tt=s(Pt,2),te=r(Tt),ge=s(te,2);e(Tt),e(Mt);var Ut=s(Mt,2),Vt=r(Ut),ee=r(Vt),fe=r(ee);e(ee),e(Vt);var ye=s(Vt,2);{var he=a=>{var o=Re();_(a,o)},we=a=>{var o=ze(),n=ie(o);{var C=w=>{var D=He();_(w,D)},m=w=>{var D=Ve(),L=ie(D),st=r(L),R=r(st),ot=r(R),B=r(ot),yt=r(B);e(B);var E=s(B),it=r(E);e(E);var F=s(E,2),lt=r(F);e(F);var H=s(F,3),dt=r(H);e(H),le(),e(ot),e(R);var nt=s(R);bt(nt,5,()=>t(gt),mt,(M,i)=>{var k=Je(),S=r(k),u=r(S,!0);e(S);var x=s(S),g=r(x),Q=r(g,!0);e(g);var $=s(g,2),Gt=r($,!0);e($),e(x);var J=s(x),vt=r(J),kt=r(vt,!0);e(vt),e(J);var ct=s(J),Ct=r(ct,!0);e(ct);var W=s(ct),ut=r(W,!0);e(W);var St=s(W),O=r(St),X=r(O,!0);e(O),e(St);var Kt=s(St),Ae=r(Kt,!0);e(Kt);var se=s(Kt),oe=r(se),$t=s(oe,2),Be=r($t,!0);e($t),e(se),e(k),b(Ee=>{c(u,(t(i),v(()=>t(i).customer))),c(Q,(t(i),v(()=>t(i).name))),c(Gt,(t(i),v(()=>t(i).email||"No email"))),Ie(vt,`background-color: ${t(i),v(()=>t(i).card_types?.color)??""}20; color: ${t(i),v(()=>t(i).card_types?.color)??""}`),c(kt,(t(i),v(()=>t(i).card_types?.name_en||"No Card"))),c(Ct,(t(i),v(()=>t(i).points))),c(ut,(t(i),v(()=>t(i).branches?.name_en||"No Branch"))),Qt(O,1,`inline-flex px-2 py-1 text-xs font-semibold rounded-full
                                 ${t(i),v(()=>t(i).status==="active"?"bg-green-100 text-green-800":t(i).status==="blocked"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800")??""}`),c(X,(t(i),v(()=>t(i).status))),c(Ae,Ee),Qt($t,1,(t(i),v(()=>t(i).status==="active"?"text-red-600 hover:text-red-900":"text-green-600 hover:text-green-900"))),c(Be,(t(i),v(()=>t(i).status==="active"?"Block":"Activate")))},[()=>(t(i),v(()=>new Date(t(i).created_at).toLocaleDateString()))]),f("click",oe,()=>ce(t(i))),f("click",$t,()=>pe(t(i))),_(M,k)}),e(nt),e(st),e(L);var ht=s(L,2);{var wt=M=>{var i=Ue(),k=r(i),S=r(k),u=s(S,2);e(k);var x=s(k,2),g=r(x),Q=r(g),$=s(r(Q)),Gt=r($,!0);e($);var J=s($,2),vt=r(J,!0);e(J);var kt=s(J,2),ct=r(kt,!0);e(kt),le(),e(Q),e(g);var Ct=s(g,2),W=r(Ct);bt(W,5,()=>(t(tt),v(()=>Array(t(tt)))),mt,(ut,St,O)=>{var X=Oe();X.textContent=O+1,b(()=>Qt(X,1,`relative inline-flex items-center px-4 py-2 border text-sm font-medium
                             ${t(h)===O+1?"z-10 bg-blue-50 border-blue-500 text-blue-600":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50"}`)),f("click",X,()=>Et(O+1)),_(ut,X)}),e(W),e(Ct),e(x),e(i),b(ut=>{S.disabled=t(h)===1,u.disabled=t(h)===t(tt),c(Gt,(t(h)-1)*rt+1),c(vt,ut),c(ct,t(I))},[()=>(t(h),t(I),v(()=>Math.min(t(h)*rt,t(I))))]),f("click",S,()=>Et(t(h)-1)),f("click",u,()=>Et(t(h)+1)),_(M,i)};Y(ht,M=>{t(tt)>1&&M(wt)})}b(()=>{c(yt,`Mobile ${t(z)==="customer"?t(A)==="asc"?"↑":"↓":""}`),c(it,`Name ${t(z)==="name"?t(A)==="asc"?"↑":"↓":""}`),c(lt,`Points ${t(z)==="points"?t(A)==="asc"?"↑":"↓":""}`),c(dt,`Joined ${t(z)==="created_at"?t(A)==="asc"?"↑":"↓":""}`)}),f("click",B,()=>ft("customer")),f("click",E,()=>ft("name")),f("click",F,()=>ft("points")),f("click",H,()=>ft("created_at")),_(w,D)};Y(n,w=>{t(gt),v(()=>t(gt).length===0)?w(C):w(m,!1)},!0)}_(a,o)};Y(ye,a=>{t(P)?a(he):a(we,!1)})}e(Ut);var ae=s(Ut,2);{var ke=a=>{var o=Ke(),n=r(o),C=r(n),m=s(r(C),2),w=r(m),D=s(r(w),2);Z(D),e(w);var L=s(w,2),st=s(r(L),2);Z(st),e(L);var R=s(L,2),ot=s(r(R),2);Z(ot),e(R);var B=s(R,2),yt=s(r(B),2);Z(yt),e(B);var E=s(B,2),it=s(r(E),2);b(()=>{t(d),pt(()=>{t(et)})}),bt(it,5,()=>t(et),mt,(u,x)=>{var g=Ge(),Q=r(g,!0);e(g);var $={};b(()=>{c(Q,(t(x),v(()=>t(x).name_en))),$!==($=(t(x),v(()=>t(x).id)))&&(g.value=(g.__value=(t(x),v(()=>t(x).id)))??"")}),_(u,g)}),e(it),e(E);var F=s(E,2),lt=s(r(F),2);b(()=>{t(d),pt(()=>{})});var H=r(lt);H.value=H.__value="active";var dt=s(H);dt.value=dt.__value="inactive";var nt=s(dt);nt.value=nt.__value="blocked",e(lt),e(F);var ht=s(F,2),wt=s(r(ht),2);Z(wt),e(ht),e(m);var M=s(m,2),i=r(M),k=s(i,2),S=r(k,!0);e(k),e(M),e(C),e(n),e(o),b(()=>{k.disabled=t(P),c(S,t(P)?"Saving...":"Save")}),T(D,()=>t(d).name,u=>U(d,t(d).name=u)),T(st,()=>t(d).email,u=>U(d,t(d).email=u)),T(ot,()=>t(d).area,u=>U(d,t(d).area=u)),T(yt,()=>t(d).points,u=>U(d,t(d).points=u)),_t(it,()=>t(d).card_type_id,u=>U(d,t(d).card_type_id=u)),_t(lt,()=>t(d).status,u=>U(d,t(d).status=u)),T(wt,()=>t(d).valid_until,u=>U(d,t(d).valid_until=u)),f("click",i,Wt),f("click",k,ue),_(a,o)};Y(ae,a=>{t(Bt)&&t(d)&&a(ke)})}var re=s(ae,2);{var Ce=a=>{var o=Qe(),n=r(o,!0);e(o),b(()=>c(n,t(q))),_(a,o)};Y(re,a=>{t(q)&&a(Ce)})}var Se=s(re,2);{var $e=a=>{var o=We(),n=r(o,!0);e(o),b(()=>c(n,t(at))),_(a,o)};Y(Se,a=>{t(at)&&a($e)})}e(Ft),b(()=>c(fe,`Customers (${t(I)??""} total)`)),T(Xt,()=>t(N),a=>l(N,a)),_t(zt,()=>t(V),a=>l(V,a)),_t(Dt,()=>t(G),a=>l(G,a)),_t(Rt,()=>t(K),a=>l(K,a)),f("click",te,be),f("click",ge,me),_(de,Ft),Ne()}export{va as component};
