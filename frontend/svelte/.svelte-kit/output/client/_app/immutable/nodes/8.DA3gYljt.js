import"../chunks/DsnmJJEf.js";import"../chunks/69_IOA4Y.js";import{o as Ie}from"../chunks/Y1pQyyvi.js";import{l as nt,q as Pe,r as dt,m as y,t as C,v as s,a as e,x as B,n as u,o as vt,y as f,w as i,s as o,A as ct,z as a,E as P,u as d,B as m,F as de,b as pt,C as qe,G as Ee,H as ut}from"../chunks/Ck91ypkQ.js";import{i as S}from"../chunks/RujGBxXx.js";import{e as Me,i as Be}from"../chunks/D775oJua.js";import{r as q,s as Fe}from"../chunks/DvH4tfbe.js";import{s as mt}from"../chunks/B38bOHRo.js";import{b as ve,a as gt}from"../chunks/C4HntxLm.js";import{b as xt}from"../chunks/xkiwYR4x.js";import{i as bt}from"../chunks/6tn_K0LM.js";import{s as ce}from"../chunks/CIOq__Tp.js";var _t=y('<div class="mb-6 bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg"><div class="flex items-center"><span class="text-green-500 mr-2">âœ…</span> </div></div>'),ft=y('<div class="mb-6 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg"><div class="flex items-center"><span class="text-red-500 mr-2">âŒ</span> </div></div>'),yt=y("<option> </option>"),ht=y('<div class="bg-blue-50 border border-blue-200 rounded-lg p-4"><h3 class="font-medium text-blue-900 mb-2"> </h3> <p class="text-blue-700 text-sm mb-2"> </p> <p class="text-blue-600 text-xs"> </p></div>'),wt=y('<tr class="hover:bg-gray-50"><td class="px-4 py-3"><input type="checkbox" class="rounded"/></td><td class="px-4 py-3 font-mono text-xs"> </td><td class="px-4 py-3 font-medium"> </td><td class="px-4 py-3 font-mono"> </td><td class="px-4 py-3"><span> </span></td><td class="px-4 py-3 text-gray-600"> </td></tr>'),Ct=y('<div class="text-center py-8 text-gray-500"><span class="text-4xl mb-2 block">ğŸ”</span> No customers found matching your search</div>'),kt=y('<div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6"><div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4"><h2 class="text-lg font-semibold text-gray-900 flex items-center mb-2 sm:mb-0"><span class="text-green-500 mr-2">ğŸ‘¥</span> Select Customers</h2> <div class="text-sm text-gray-500"> </div></div> <div class="flex flex-col sm:flex-row gap-3 mb-4"><div class="flex-1"><input type="text" placeholder="Search by name, mobile, or customer ID..." class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"/></div> <div class="flex gap-2"><button class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm whitespace-nowrap">Select All</button> <button class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors text-sm whitespace-nowrap">Clear</button></div></div> <div class="overflow-x-auto"><div class="max-h-96 overflow-y-auto"><table class="w-full text-sm"><thead class="bg-gray-50 sticky top-0"><tr><th class="px-4 py-3 text-left"><input type="checkbox" class="rounded"/></th><th class="px-4 py-3 text-left font-medium text-gray-700">Customer ID</th><th class="px-4 py-3 text-left font-medium text-gray-700">Name</th><th class="px-4 py-3 text-left font-medium text-gray-700">Mobile</th><th class="px-4 py-3 text-left font-medium text-gray-700">Card Type</th><th class="px-4 py-3 text-left font-medium text-gray-700">Points</th></tr></thead><tbody class="divide-y divide-gray-200"></tbody></table></div></div> <!></div>'),At=y('<div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6"><div class="text-center py-8"><span class="text-6xl mb-4 block">ğŸŒ</span> <h3 class="text-lg font-semibold text-gray-900 mb-2">Assign to All Customers</h3> <p class="text-gray-600 mb-4"> </p> <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 inline-block"><p class="text-blue-700 text-sm">All current and future customers will receive this coupon</p></div></div></div>'),St=y('<div class="animate-spin rounded-full h-5 w-5 border-2 border-white border-t-transparent"></div> Assigning...',1),Dt=y('<span class="text-xl">ğŸ¯</span> Assign Coupon <!>',1),Tt=y('<div class="min-h-screen bg-gray-50 p-4 md:p-6"><div class="max-w-7xl mx-auto"><div class="mb-6"><h1 class="text-2xl md:text-3xl font-bold text-gray-900 mb-2">Assign Coupons</h1> <p class="text-gray-600">Assign coupons to individual customers, bulk selection, or all customers</p></div> <!> <!> <div class="grid grid-cols-1 lg:grid-cols-3 gap-6"><div class="lg:col-span-1"><div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6"><h2 class="text-lg font-semibold text-gray-900 mb-4 flex items-center"><span class="text-blue-500 mr-2">ğŸŸï¸</span> Select Coupon</h2> <div class="space-y-4"><div><label class="block text-sm font-medium text-gray-700 mb-2">Available Coupons</label> <select class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"><option>Select a coupon...</option><!></select></div> <!> <div><label class="block text-sm font-medium text-gray-700 mb-2">Assignment Type</label> <div class="space-y-2"><label class="flex items-center"><input type="radio" class="mr-2"/> <span class="text-sm">Individual Selection</span></label> <label class="flex items-center"><input type="radio" class="mr-2"/> <span class="text-sm">Bulk Selection</span></label> <label class="flex items-center"><input type="radio" class="mr-2"/> <span class="text-sm">All Customers</span></label></div></div></div></div></div> <div class="lg:col-span-2"><!></div></div> <div class="mt-6 flex justify-center"><button class="px-8 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 flex items-center gap-2 text-lg font-medium"><!></button></div></div></div>');function Gt(Re,je){nt(je,!1);const _=f(),E=f(),O=[];let x=f(""),g=f("individual"),n=f([]),D=f(""),T=f(!1),M=f(""),k=f(""),F=f([]),$=f([]);Ie(()=>{ze()});async function ze(){o(T,!0);try{const t=await ce.from("coupons").select("*").eq("status","active").gt("expires_at",new Date().toISOString()).order("created_at",{ascending:!1});t.data&&o(F,t.data.map(l=>({id:l.id,code:l.code,description:l.value,expiresAt:l.expires_at,type:l.type})));const r=await ce.from("customers").select("id, customer, name, area, points, card_type_id, card_types(name_en)").eq("status","active").order("name");r.data&&o($,r.data.map(l=>({id:l.id,name:l.name,mobile:l.customer,cardType:l.card_types?.name_en||"Bronze",points:l.points})))}catch(t){console.error("Error loading data:",t),o(k,"Failed to load data. Please refresh the page.")}finally{o(T,!1)}}function Ge(t){e(n).includes(t)?o(n,e(n).filter(r=>r!==t)):o(n,[...e(n),t])}function pe(){o(n,e(_).map(t=>t.id))}function ue(){o(n,[])}async function Ne(){if(!e(x)){o(k,"Please select a coupon to assign");return}if(e(g)!=="all"&&e(n).length===0){o(k,"Please select at least one customer");return}o(T,!0),o(k,"");try{const t=e(F).find(c=>c.id===e(x));let r=[];e(g)==="all"?r=e($).map(c=>c.id):r=e(n);const l=r.map(c=>({coupon_id:e(x),customer_id:c,status:"unused",assigned_at:new Date().toISOString()})),{error:v}=await ce.from("coupon_usage").insert(l);if(v)throw v;const b=r.length;o(M,`Successfully assigned "${t?.description}" to ${b} customers`),o(x,""),o(n,[]),o(g,"individual"),o(D,"")}catch(t){console.error("Error assigning coupons:",t),o(k,"Failed to assign coupons. Please try again.")}finally{o(T,!1)}}Ie(()=>{const t=setInterval(()=>{e(M)&&o(M,""),e(k)&&o(k,"")},5e3);return()=>clearInterval(t)}),Pe(()=>(e($),e(D)),()=>{o(_,e($).filter(t=>t.name.toLowerCase().includes(e(D).toLowerCase())||t.mobile.includes(e(D))||t.id.toLowerCase().includes(e(D).toLowerCase())))}),Pe(()=>e(F),()=>{o(E,e(F).filter(t=>new Date(t.expiresAt)>new Date))}),dt(),bt();var H=Tt(),me=s(H),ge=i(s(me),2);{var Oe=t=>{var r=_t(),l=s(r),v=i(s(l));a(l),a(r),C(()=>m(v,` ${e(M)??""}`)),u(t,r)};S(ge,t=>{e(M)&&t(Oe)})}var xe=i(ge,2);{var He=t=>{var r=ft(),l=s(r),v=i(s(l));a(l),a(r),C(()=>m(v,` ${e(k)??""}`)),u(t,r)};S(xe,t=>{e(k)&&t(He)})}var Q=i(xe,2),J=s(Q),be=s(J),_e=i(s(be),2),K=s(_e),U=i(s(K),2);C(()=>{e(x),ct(()=>{e(E)})});var V=s(U);V.value=V.__value="";var Qe=i(V);Me(Qe,1,()=>e(E),Be,(t,r)=>{var l=yt(),v=s(l);a(l);var b={};C(()=>{m(v,`${e(r),d(()=>e(r).code)??""} - ${e(r),d(()=>e(r).description)??""}`),b!==(b=(e(r),d(()=>e(r).id)))&&(l.value=(l.__value=(e(r),d(()=>e(r).id)))??"")}),u(t,l)}),a(U),a(K);var fe=i(K,2);{var Je=t=>{var r=ht();const l=pt(()=>(e(E),e(x),d(()=>e(E).find(w=>w.id===e(x)))));var v=s(r),b=s(v,!0);a(v);var c=i(v,2),h=s(c,!0);a(c);var L=i(c,2),I=s(L);a(L),a(r),C(w=>{m(b,(de(e(l)),d(()=>e(l)?.code))),m(h,(de(e(l)),d(()=>e(l)?.description))),m(I,`Expires: ${w??""}`)},[()=>(de(e(l)),d(()=>new Date(e(l)?.expiresAt||"").toLocaleDateString()))]),u(t,r)};S(fe,t=>{e(x)&&t(Je)})}var ye=i(fe,2),he=i(s(ye),2),W=s(he),R=s(W);q(R),R.value=R.__value="individual",P(2),a(W);var X=i(W,2),j=s(X);q(j),j.value=j.__value="bulk",P(2),a(X);var we=i(X,2),z=s(we);q(z),z.value=z.__value="all",P(2),a(we),a(he),a(ye),a(_e),a(be),a(J);var Ce=i(J,2),Ke=s(Ce);{var Ue=t=>{var r=kt(),l=s(r),v=i(s(l),2),b=s(v);a(v),a(l);var c=i(l,2),h=s(c),L=s(h);q(L),a(h);var I=i(h,2),w=s(I),N=i(w,2);a(I),a(c);var Y=i(c,2),Ae=s(Y),Se=s(Ae),Z=s(Se),De=s(Z),Te=s(De),ee=s(Te);q(ee),a(Te),P(5),a(De),a(Z);var Le=i(Z);Me(Le,5,()=>e(_),Be,(A,p)=>{var te=wt(),ae=s(te),se=s(ae);q(se),a(ae);var re=i(ae),tt=s(re,!0);a(re);var le=i(re),at=s(le,!0);a(le);var ie=i(le),st=s(ie,!0);a(ie);var oe=i(ie),ne=s(oe),rt=s(ne,!0);a(ne),a(oe);var $e=i(oe),lt=s($e,!0);a($e),a(te),C((it,ot)=>{Fe(se,it),m(tt,(e(p),d(()=>e(p).id))),m(at,(e(p),d(()=>e(p).name))),m(st,(e(p),d(()=>e(p).mobile))),mt(ne,1,`px-2 py-1 rounded-full text-xs font-medium
                            ${e(p),d(()=>e(p).cardType==="Gold"?"bg-yellow-100 text-yellow-800":e(p).cardType==="Silver"?"bg-gray-100 text-gray-800":"bg-orange-100 text-orange-800")??""}`),m(rt,(e(p),d(()=>e(p).cardType))),m(lt,ot)},[()=>(e(n),e(p),d(()=>e(n).includes(e(p).id))),()=>(e(p),d(()=>e(p).points.toLocaleString()))]),B("change",se,()=>Ge(e(p).id)),u(A,te)}),a(Le),a(Se),a(Ae),a(Y);var Ze=i(Y,2);{var et=A=>{var p=Ct();u(A,p)};S(Ze,A=>{e(_),d(()=>e(_).length===0)&&A(et)})}a(r),C(()=>{m(b,`${e(n),d(()=>e(n).length)??""} of ${e(_),d(()=>e(_).length)??""} selected`),Fe(ee,(e(n),e(_),d(()=>e(n).length===e(_).length&&e(_).length>0)))}),gt(L,()=>e(D),A=>o(D,A)),B("click",w,pe),B("click",N,ue),B("change",ee,function(...A){(e(n).length===e(_).length?ue:pe)?.apply(this,A)}),u(t,r)},Ve=t=>{var r=At(),l=s(r),v=i(s(l),4),b=s(v);a(v),P(2),a(l),a(r),C(()=>m(b,`This coupon will be assigned to all ${e($),d(()=>e($).length)??""} customers in the system`)),u(t,r)};S(Ke,t=>{e(g)!=="all"?t(Ue):t(Ve,!1)})}a(Ce),a(Q);var ke=i(Q,2),G=s(ke),We=s(G);{var Xe=t=>{var r=St();P(),u(t,r)},Ye=t=>{var r=Dt(),l=i(qe(r),2);{var v=c=>{var h=Ee("to All Customers");u(c,h)},b=c=>{var h=ut(),L=qe(h);{var I=w=>{var N=Ee();C(()=>m(N,`to ${e(n),d(()=>e(n).length)??""} Customer${e(n),d(()=>e(n).length>1?"s":"")??""}`)),u(w,N)};S(L,w=>{e(n),d(()=>e(n).length>0)&&w(I)},!0)}u(c,h)};S(l,c=>{e(g)==="all"?c(v):c(b,!1)})}u(t,r)};S(We,t=>{e(T)?t(Xe):t(Ye,!1)})}a(G),a(ke),a(me),a(H),C(()=>G.disabled=(e(T),e(x),e(g),e(n),d(()=>e(T)||!e(x)||e(g)!=="all"&&e(n).length===0))),xt(U,()=>e(x),t=>o(x,t)),ve(O,[],R,()=>e(g),t=>o(g,t)),ve(O,[],j,()=>e(g),t=>o(g,t)),ve(O,[],z,()=>e(g),t=>o(g,t)),B("click",G,Ne),u(Re,H),vt()}export{Gt as component};
