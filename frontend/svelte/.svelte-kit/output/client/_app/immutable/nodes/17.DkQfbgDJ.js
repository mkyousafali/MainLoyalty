import"../chunks/DsnmJJEf.js";import"../chunks/69_IOA4Y.js";import{o as He}from"../chunks/Y1pQyyvi.js";import{l as Ne,q as Pe,r as Ue,m as b,C as Ge,x as B,n as g,o as De,a as e,y as q,w as o,v as a,s as n,z as r,t as M,B as y,u as v,E as be,I as D,A as Re}from"../chunks/Ck91ypkQ.js";import{i as z}from"../chunks/RujGBxXx.js";import{e as ne,i as le}from"../chunks/D775oJua.js";import{r as T,a as Se}from"../chunks/DvH4tfbe.js";import{s as Ve}from"../chunks/B38bOHRo.js";import{s as de}from"../chunks/CNyBBxAM.js";import{a as ee}from"../chunks/C4HntxLm.js";import{b as Ie}from"../chunks/xkiwYR4x.js";import{p as Oe}from"../chunks/D4Caz1gY.js";import{i as We}from"../chunks/6tn_K0LM.js";import{s as R}from"../chunks/CIOq__Tp.js";var Je=b('<div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-6"><div class="flex"><svg class="w-5 h-5 text-red-400 mr-2 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L3.34 16.5c-.77.833.192 2.5 1.732 2.5z"></path></svg> <p class="text-red-800"> </p></div></div>'),Ke=b('<div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-6"><div class="flex"><svg class="w-5 h-5 text-green-400 mr-2 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <p class="text-green-800"> </p></div></div>'),Qe=b('<div class="text-center py-12"><div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div> <p class="mt-4 text-gray-600">Loading card types...</p></div>'),Xe=b('<p class="text-sm text-gray-600"> </p>'),Ye=b('<div class="flex items-center justify-between"><span class="text-sm text-gray-600">Upgrades to:</span> <span class="text-sm font-medium text-blue-600"> </span></div>'),Ze=b('<div class="flex items-center justify-between"><span class="text-sm text-gray-600">Upgrades to:</span> <span class="text-sm text-gray-400">Top tier</span></div>'),Te=b('<div class="bg-white rounded-lg border border-gray-200 overflow-hidden shadow-sm hover:shadow-md transition-shadow"><div class="h-20 relative"><div class="absolute inset-0 bg-gradient-to-br from-white/20 to-transparent"></div> <div class="absolute top-4 left-4"><div class="w-12 h-8 bg-white/30 rounded backdrop-blur-sm flex items-center justify-center"><svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path></svg></div></div> <div class="absolute top-4 right-4"><div class="flex space-x-2"><button class="p-1.5 bg-white/30 hover:bg-white/50 rounded backdrop-blur-sm transition-colors"><svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg></button> <button class="p-1.5 bg-white/30 hover:bg-red-500/70 rounded backdrop-blur-sm transition-colors"><svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg></button></div></div></div> <div class="p-6"><div class="flex items-start justify-between mb-4"><div><h3 class="text-lg font-semibold text-gray-900"> </h3> <!></div> <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800"> </span></div> <div class="space-y-3"><div class="flex items-center justify-between"><span class="text-sm text-gray-600">Point Requirement:</span> <span class="font-medium"> </span></div> <!> <div class="flex items-center justify-between"><span class="text-sm text-gray-600">Color:</span> <div class="flex items-center space-x-2"><div class="w-4 h-4 rounded border border-gray-300"></div> <span class="text-sm font-mono"> </span></div></div></div></div></div>'),et=b('<div class="col-span-full text-center py-12"><svg class="w-16 h-16 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path></svg> <h3 class="text-lg font-medium text-gray-900 mb-2">No card types found</h3> <p class="text-gray-600 mb-4">Get started by creating your first loyalty card type</p> <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">Create Card Type</button></div>'),tt=b('<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"><!> <!></div>'),rt=b('<button type="button"></button>'),at=b("<option> </option>"),ot=b('<div class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"><div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white"><div class="mt-3"><div class="flex items-center justify-between mb-4"><h3 class="text-lg font-medium text-gray-900"> </h3> <button class="text-gray-400 hover:text-gray-600"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div> <form class="space-y-4"><div><label class="block text-sm font-medium text-gray-700 mb-1">English Name *</label> <input type="text" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g., Bronze, Silver, Gold"/></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">Arabic Name</label> <input type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g., برونزي، فضي، ذهبي"/></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">Point Requirement</label> <input type="number" min="0" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="0"/> <p class="text-xs text-gray-500 mt-1">Minimum points needed to qualify for this card type</p></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">Card Color</label> <div class="grid grid-cols-4 gap-2 mb-2"></div> <input type="color" class="w-full h-10 border border-gray-300 rounded cursor-pointer"/></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">Upgrades To</label> <select class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"><option>No upgrade (Top tier)</option><!></select> <p class="text-xs text-gray-500 mt-1">Next card type customers upgrade to automatically</p></div> <div class="flex justify-end space-x-3 pt-4"><button type="button" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition-colors">Cancel</button> <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors"> </button></div></form></div></div></div>'),st=b('<div class="min-h-screen bg-gray-50 p-4 md:p-6"><div class="max-w-7xl mx-auto"><div class="flex justify-between items-center mb-6"><div><h1 class="text-2xl md:text-3xl font-bold text-gray-900 mb-2">Manage Card Types</h1> <p class="text-gray-600">Create and manage customer loyalty card types and upgrade paths</p></div> <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors"><svg class="w-5 h-5 inline-block mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg> Add Card Type</button></div> <!> <!> <!></div></div> <!>',1);function ht(fe,xe){Ne(xe,!1);let S=q([]),te=q(!1),L=q(!1),w=q(null),p=q(""),k=q(""),s=q({name_en:"",name_ar:"",color:"#3B82F6",point_limit:0,upgrade_to:null});const he=[{name:"Bronze",value:"#CD7F32"},{name:"Silver",value:"#C0C0C0"},{name:"Gold",value:"#FFD700"},{name:"Platinum",value:"#E5E4E2"},{name:"Blue",value:"#3B82F6"},{name:"Green",value:"#10B981"},{name:"Purple",value:"#8B5CF6"},{name:"Red",value:"#EF4444"}];He(()=>{re()});async function re(){try{n(te,!0),n(p,"");const{data:t,error:l}=await R.from("card_types").select("*").order("point_limit");if(l)throw l;const d=await Promise.all((t||[]).map(async c=>{const{count:x}=await R.from("customers").select("*",{count:"exact",head:!0}).eq("card_type_id",c.id),h=t?.find(i=>i.id===c.upgrade_to);return{...c,customer_count:x||0,upgrade_to_name:h?.name_en||null}}));n(S,d)}catch(t){n(p,`Failed to load card types: ${t.message}`)}finally{n(te,!1)}}function ve(){n(w,null),n(s,{name_en:"",name_ar:"",color:"#3B82F6",point_limit:0,upgrade_to:null}),n(L,!0)}function ye(t){n(w,t),n(s,{name_en:t.name_en,name_ar:t.name_ar||"",color:t.color,point_limit:t.point_limit,upgrade_to:t.upgrade_to}),n(L,!0)}async function we(){try{if(n(p,""),n(k,""),!e(s).name_en.trim()){n(p,"English name is required");return}if(e(s).point_limit<0){n(p,"Point limit cannot be negative");return}if(e(w)){const{error:t}=await R.from("card_types").update({name_en:e(s).name_en.trim(),name_ar:e(s).name_ar.trim()||null,color:e(s).color,point_limit:e(s).point_limit,upgrade_to:e(s).upgrade_to||null}).eq("id",e(w).id);if(t)throw t;n(k,"Card type updated successfully")}else{const{error:t}=await R.from("card_types").insert([{name_en:e(s).name_en.trim(),name_ar:e(s).name_ar.trim()||null,color:e(s).color,point_limit:e(s).point_limit,upgrade_to:e(s).upgrade_to||null}]);if(t)throw t;n(k,"Card type created successfully")}n(L,!1),await re()}catch(t){n(p,`Failed to save card type: ${t.message}`)}}async function ke(t,l){if(confirm(`Are you sure you want to delete "${l}"? This cannot be undone.`))try{n(p,"");const{count:d}=await R.from("customers").select("*",{count:"exact",head:!0}).eq("card_type_id",t);if(d&&d>0){n(p,`Cannot delete "${l}" because ${d} customers are using this card type`);return}const{error:c}=await R.from("card_types").delete().eq("id",t);if(c)throw c;n(k,"Card type deleted successfully"),await re()}catch(d){n(p,`Failed to delete card type: ${d.message}`)}}function Ce(t){return e(S).filter(l=>!(t&&l.id===t.id||t&&l.point_limit<=t.point_limit))}Pe(()=>(e(k),e(p)),()=>{(e(k)||e(p))&&setTimeout(()=>{n(k,""),n(p,"")},5e3)}),Ue(),We();var ue=st(),ae=Ge(ue),ce=a(ae),oe=a(ce),Me=o(a(oe),2);r(oe);var me=o(oe,2);{var je=t=>{var l=Je(),d=a(l),c=o(a(d),2),x=a(c,!0);r(c),r(d),r(l),M(()=>y(x,e(p))),g(t,l)};z(me,t=>{e(p)&&t(je)})}var pe=o(me,2);{var Be=t=>{var l=Ke(),d=a(l),c=o(a(d),2),x=a(c,!0);r(c),r(d),r(l),M(()=>y(x,e(k))),g(t,l)};z(pe,t=>{e(k)&&t(Be)})}var Ee=o(pe,2);{var Fe=t=>{var l=Qe();g(t,l)},$e=t=>{var l=tt(),d=a(l);ne(d,1,()=>e(S),le,(h,i)=>{var E=Te(),j=a(E),A=o(a(j),4),V=a(A),H=a(V),Q=o(H,2);r(V),r(A),r(j);var N=o(j,2),P=a(N),F=a(P),$=a(F),X=a($,!0);r($);var I=o($,2);{var O=f=>{var C=Xe(),Z=a(C,!0);r(C),M(()=>y(Z,(e(i),v(()=>e(i).name_ar)))),g(f,C)};z(I,f=>{e(i),v(()=>e(i).name_ar)&&f(O)})}r(F);var U=o(F,2),se=a(U);r(U),r(P);var W=o(P,2),G=a(W),J=o(a(G),2),ie=a(J);r(J),r(G);var m=o(G,2);{var u=f=>{var C=Ye(),Z=o(a(C),2),Ae=a(Z,!0);r(Z),r(C),M(()=>y(Ae,(e(i),v(()=>e(i).upgrade_to_name)))),g(f,C)},_=f=>{var C=Ze();g(f,C)};z(m,f=>{e(i),v(()=>e(i).upgrade_to_name)?f(u):f(_,!1)})}var Y=o(m,2),K=o(a(Y),2),_e=a(K),ge=o(_e,2),Le=a(ge,!0);r(ge),r(K),r(Y),r(W),r(N),r(E),M(f=>{de(j,`background-color: ${e(i),v(()=>e(i).color)??""}`),y(X,(e(i),v(()=>e(i).name_en))),y(se,`${e(i),v(()=>e(i).customer_count)??""} customers`),y(ie,`${f??""} pts`),de(_e,`background-color: ${e(i),v(()=>e(i).color)??""}`),y(Le,(e(i),v(()=>e(i).color)))},[()=>(e(i),v(()=>e(i).point_limit.toLocaleString()))]),B("click",H,()=>ye(e(i))),B("click",Q,()=>ke(e(i).id,e(i).name_en)),g(h,E)});var c=o(d,2);{var x=h=>{var i=et(),E=o(a(i),6);r(i),B("click",E,ve),g(h,i)};z(c,h=>{e(S),v(()=>e(S).length===0)&&h(x)})}r(l),g(t,l)};z(Ee,t=>{e(te)?t(Fe):t($e,!1)})}r(ce),r(ae);var qe=o(ae,2);{var ze=t=>{var l=ot(),d=a(l),c=a(d),x=a(c),h=a(x),i=a(h,!0);r(h);var E=o(h,2);r(x);var j=o(x,2),A=a(j),V=o(a(A),2);T(V),r(A);var H=o(A,2),Q=o(a(H),2);T(Q),r(H);var N=o(H,2),P=o(a(N),2);T(P),be(2),r(N);var F=o(N,2),$=o(a(F),2);ne($,5,()=>he,le,(m,u)=>{var _=rt();M(()=>{Ve(_,1,`w-full h-10 rounded border-2 ${e(s),e(u),v(()=>e(s).color===e(u).value?"border-gray-900":"border-gray-300")??""} hover:border-gray-400 transition-colors`),de(_,`background-color: ${e(u),v(()=>e(u).value)??""}`),Se(_,"title",(e(u),v(()=>e(u).name)))}),B("click",_,()=>D(s,e(s).color=e(u).value)),g(m,_)}),r($);var X=o($,2);T(X),r(F);var I=o(F,2),O=o(a(I),2);M(()=>{e(s),Re(()=>{e(w)})});var U=a(O);U.value=(U.__value=null)??"";var se=o(U);ne(se,1,()=>(e(w),v(()=>Ce(e(w)))),le,(m,u)=>{var _=at(),Y=a(_);r(_);var K={};M(()=>{y(Y,`${e(u),v(()=>e(u).name_en)??""} (${e(u),v(()=>e(u).point_limit)??""} pts)`),K!==(K=(e(u),v(()=>e(u).id)))&&(_.value=(_.__value=(e(u),v(()=>e(u).id)))??"")}),g(m,_)}),r(O),be(2),r(I);var W=o(I,2),G=a(W),J=o(G,2),ie=a(J);r(J),r(W),r(j),r(c),r(d),r(l),M(()=>{y(i,e(w)?"Edit Card Type":"Create New Card Type"),y(ie,`${e(w)?"Update":"Create"} Card Type`)}),B("click",E,()=>n(L,!1)),ee(V,()=>e(s).name_en,m=>D(s,e(s).name_en=m)),ee(Q,()=>e(s).name_ar,m=>D(s,e(s).name_ar=m)),ee(P,()=>e(s).point_limit,m=>D(s,e(s).point_limit=m)),ee(X,()=>e(s).color,m=>D(s,e(s).color=m)),Ie(O,()=>e(s).upgrade_to,m=>D(s,e(s).upgrade_to=m)),B("click",G,()=>n(L,!1)),B("submit",j,Oe(we)),g(t,l)};z(qe,t=>{e(L)&&t(ze)})}B("click",Me,ve),g(fe,ue),De()}export{ht as component};
