import"../chunks/DsnmJJEf.js";import"../chunks/69_IOA4Y.js";import{o as zt}from"../chunks/Y1pQyyvi.js";import{l as Lt,m as b,t as x,v as r,w as o,x as C,a as t,n as u,o as Bt,y,B as p,s,z as a,A as be,H as Gt,C as Ht,K as Jt,E as Kt,I as _e,b as Vt}from"../chunks/Ck91ypkQ.js";import{i as T}from"../chunks/RujGBxXx.js";import{e as ge,i as xe}from"../chunks/D775oJua.js";import{r as et}from"../chunks/DvH4tfbe.js";import{s as tt}from"../chunks/B38bOHRo.js";import{a as ye}from"../chunks/C4HntxLm.js";import{b as he}from"../chunks/xkiwYR4x.js";import{p as Wt}from"../chunks/D4Caz1gY.js";import{i as Pt}from"../chunks/6tn_K0LM.js";import{s as h}from"../chunks/CIOq__Tp.js";var Qt=b("<option> </option>"),Xt=b('<div class="p-8 text-center"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"></div> <p class="text-gray-600 mt-2">Loading notifications...</p></div>'),Yt=b('<div class="p-8 text-center text-gray-500">No notifications found matching your criteria.</div>'),Zt=b('<span class="w-2 h-2 bg-blue-600 rounded-full"></span>'),ea=b("<span> </span>"),ta=b("<span>• To: All Admins</span>"),aa=b("<span> </span>"),ra=b('<button class="text-blue-600 hover:text-blue-800 text-sm font-medium">Mark Unread</button>'),ia=b('<button class="text-green-600 hover:text-green-800 text-sm font-medium">Mark Read</button>'),oa=b('<div><div class="flex items-start justify-between"><div class="flex items-start space-x-4"><div class="text-2xl"> </div> <div class="flex-1"><div class="flex items-center space-x-2 mb-1"><span> </span> <!></div> <p class="text-gray-900 mb-2"> </p> <div class="flex items-center space-x-4 text-sm text-gray-500"><span> </span> <!> <!></div></div></div> <div class="flex items-center space-x-2"><!> <button class="text-red-600 hover:text-red-800 text-sm font-medium">Delete</button></div></div></div>'),sa=b('<div class="divide-y divide-gray-200"></div>'),la=b("<option> </option>"),da=b('<div class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"><div class="relative top-20 mx-auto p-5 border w-full max-w-md shadow-lg rounded-md bg-white"><div class="mt-3"><h3 class="text-lg font-medium text-gray-900 mb-4">Create Notification</h3> <form class="space-y-4"><div><label class="block text-sm font-medium text-gray-700 mb-1">Type</label> <select required class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"></select></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">Message</label> <textarea required rows="3" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Enter notification message..."></textarea></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">Visible To (Optional)</label> <input type="text" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Leave empty for all admins"/> <p class="text-xs text-gray-500 mt-1">User ID to show this notification to specifically</p></div> <div class="flex justify-end space-x-2 mt-6"><button type="button" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400">Cancel</button> <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-400"> </button></div></form></div></div></div>'),na=b('<div class="fixed bottom-4 right-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded z-50"> </div>'),va=b('<div class="fixed bottom-4 right-4 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded z-50"> </div>'),ca=b('<div class="p-6"><div class="max-w-7xl mx-auto"><div class="mb-8"><div class="flex justify-between items-center"><div><h1 class="text-3xl font-bold text-gray-900 mb-2">Notification Center</h1> <p class="text-gray-600">Manage system notifications and alerts.</p></div> <div class="flex space-x-3"><button class="bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700 text-sm">Mark All Read</button> <button class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 text-sm">Clear All</button> <button class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">+ Create Notification</button></div></div></div> <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8"><div class="bg-white rounded-lg shadow p-6"><div class="flex items-center"><div class="text-3xl text-blue-600 mr-4">🔔</div> <div><p class="text-sm font-medium text-gray-500">Total Notifications</p> <p class="text-2xl font-bold text-gray-900"> </p></div></div></div> <div class="bg-white rounded-lg shadow p-6"><div class="flex items-center"><div class="text-3xl text-red-600 mr-4">🔴</div> <div><p class="text-sm font-medium text-gray-500">Unread</p> <p class="text-2xl font-bold text-gray-900"> </p></div></div></div> <div class="bg-white rounded-lg shadow p-6"><div class="flex items-center"><div class="text-3xl text-green-600 mr-4">✅</div> <div><p class="text-sm font-medium text-gray-500">Read</p> <p class="text-2xl font-bold text-gray-900"> </p></div></div></div> <div class="bg-white rounded-lg shadow p-6"><div class="flex items-center"><div class="text-3xl text-purple-600 mr-4">📊</div> <div><p class="text-sm font-medium text-gray-500">Most Common</p> <p class="text-sm font-bold text-gray-900"> </p></div></div></div></div> <div class="bg-white rounded-lg shadow p-6 mb-6"><h2 class="text-lg font-semibold mb-4">Filters</h2> <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4"><div><label class="block text-sm font-medium text-gray-700 mb-2">Type</label> <select class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"><option>All Types</option><!></select></div> <div><label class="block text-sm font-medium text-gray-700 mb-2">Status</label> <select class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"><option>All Status</option><option>Unread</option><option>Read</option></select></div> <div><label class="block text-sm font-medium text-gray-700 mb-2">Search</label> <input type="text" placeholder="Search messages..." class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"/></div></div> <div class="flex gap-4"><button class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">Apply Filters</button> <button class="bg-gray-600 text-white px-6 py-2 rounded-lg hover:bg-gray-700">Clear Filters</button></div></div> <div class="bg-white rounded-lg shadow overflow-hidden"><div class="px-6 py-4 border-b border-gray-200"><h2 class="text-lg font-semibold"> </h2></div> <!></div> <!> <!> <!></div></div>');function Ca(at,rt){Lt(rt,!1);let R=y([]),F=y(!1),w=y(""),$=y(""),I=y(""),U=y(""),O=y(""),H=y(!1),_=y({type:"system",message:"",visible_to:""}),J=y(0),K=y(0),V=y({});const B=[{value:"upgrade",label:"Card Upgrades",icon:"⬆️",color:"blue"},{value:"expiry",label:"Expiry Warnings",icon:"⏰",color:"yellow"},{value:"gift_claim",label:"Gift Claims",icon:"🎁",color:"green"},{value:"reward_assigned",label:"Reward Assignments",icon:"🏆",color:"purple"},{value:"system",label:"System Messages",icon:"🔔",color:"gray"}];zt(()=>{M(),D()});async function M(){try{s(F,!0);let e=h.from("notifications").select("*").order("created_at",{ascending:!1});t(I)&&(e=e.eq("type",t(I))),t(U)==="read"?e=e.not("read_at","is",null):t(U)==="unread"&&(e=e.is("read_at",null)),t(O)&&(e=e.ilike("message",`%${t(O)}%`));const{data:i,error:d}=await e;if(d)throw d;if(i&&i.length>0){const n=[...new Set(i.map(v=>v.visible_to).filter(Boolean))];if(n.length>0){const{data:v}=await h.from("users").select("id, name, email").in("id",n),g={};v?.forEach(f=>{g[f.id]=f}),s(R,i.map(f=>({...f,visible_to_user:f.visible_to?g[f.visible_to]:null})))}else s(R,i.map(v=>({...v,visible_to_user:null})))}else s(R,i||[])}catch(e){s(w,`Failed to load notifications: ${e.message}`)}finally{s(F,!1)}}async function D(){try{const{count:e}=await h.from("notifications").select("*",{count:"exact",head:!0});s(J,e||0);const{count:i}=await h.from("notifications").select("*",{count:"exact",head:!0}).is("read_at",null);s(K,i||0);const{data:d}=await h.from("notifications").select("type");d&&s(V,d.reduce((n,v)=>(n[v.type]=(n[v.type]||0)+1,n),{}))}catch(e){console.error("Failed to load statistics:",e)}}function it(){s(_,{type:"system",message:"",visible_to:""}),s(H,!0)}function we(){s(H,!1),s(w,""),s($,"")}async function ot(){try{s(F,!0);const e={type:t(_).type,message:t(_).message.trim(),visible_to:t(_).visible_to||null},{error:i}=await h.from("notifications").insert(e);if(i)throw i;s($,"Notification created successfully!"),we(),M(),D()}catch(e){s(w,`Failed to create notification: ${e.message}`)}finally{s(F,!1)}}async function st(e){try{const{error:i}=await h.from("notifications").update({read_at:new Date().toISOString()}).eq("id",e.id);if(i)throw i;M(),D()}catch(i){s(w,`Failed to mark notification as read: ${i.message}`)}}async function lt(e){try{const{error:i}=await h.from("notifications").update({read_at:null}).eq("id",e.id);if(i)throw i;M(),D()}catch(i){s(w,`Failed to mark notification as unread: ${i.message}`)}}async function dt(e){if(confirm("Are you sure you want to delete this notification?"))try{const{error:i}=await h.from("notifications").delete().eq("id",e.id);if(i)throw i;s($,"Notification deleted successfully!"),M(),D()}catch(i){s(w,`Failed to delete notification: ${i.message}`)}}async function nt(){try{const{error:e}=await h.from("notifications").update({read_at:new Date().toISOString()}).is("read_at",null);if(e)throw e;s($,"All notifications marked as read!"),M(),D()}catch(e){s(w,`Failed to mark all notifications as read: ${e.message}`)}}async function vt(){if(confirm("Are you sure you want to clear all notifications? This action cannot be undone."))try{const{error:e}=await h.from("notifications").delete().neq("id","00000000-0000-0000-0000-000000000000");if(e)throw e;s($,"All notifications cleared!"),M(),D()}catch(e){s(w,`Failed to clear notifications: ${e.message}`)}}function ct(e){return B.find(i=>i.value===e)||B[4]}function ke(e){const i=new Date(e),n=Math.floor((new Date().getTime()-i.getTime())/1e3);return n<60?"Just now":n<3600?`${Math.floor(n/60)}m ago`:n<86400?`${Math.floor(n/3600)}h ago`:n<2592e3?`${Math.floor(n/86400)}d ago`:i.toLocaleDateString()}function ut(){M()}function ft(){s(I,""),s(U,""),s(O,""),M()}Pt();var W=ca(),Ae=r(W),P=r(Ae),Ce=r(P),Me=o(r(Ce),2),Te=r(Me),Ne=o(Te,2),mt=o(Ne,2);a(Me),a(Ce),a(P);var Q=o(P,2),X=r(Q),Se=r(X),Fe=o(r(Se),2),$e=o(r(Fe),2),pt=r($e,!0);a($e),a(Fe),a(Se),a(X);var Y=o(X,2),De=r(Y),Ee=o(r(De),2),qe=o(r(Ee),2),bt=r(qe,!0);a(qe),a(Ee),a(De),a(Y);var Z=o(Y,2),Re=r(Z),Ie=o(r(Re),2),Ue=o(r(Ie),2),_t=r(Ue,!0);a(Ue),a(Ie),a(Re),a(Z);var je=o(Z,2),Oe=r(je),ze=o(r(Oe),2),Le=o(r(ze),2),gt=r(Le,!0);a(Le),a(ze),a(Oe),a(je),a(Q);var ee=o(Q,2),te=o(r(ee),2),ae=r(te),re=o(r(ae),2);x(()=>{t(I),be(()=>{})});var ie=r(re);ie.value=ie.__value="";var xt=o(ie);ge(xt,1,()=>B,xe,(e,i)=>{var d=Qt(),n=r(d);a(d);var v={};x(()=>{p(n,`${t(i).icon??""} ${t(i).label??""}`),v!==(v=t(i).value)&&(d.value=(d.__value=t(i).value)??"")}),u(e,d)}),a(re),a(ae);var oe=o(ae,2),se=o(r(oe),2);x(()=>{t(U),be(()=>{})});var le=r(se);le.value=le.__value="";var de=o(le);de.value=de.__value="unread";var Be=o(de);Be.value=Be.__value="read",a(se),a(oe);var Ge=o(oe,2),He=o(r(Ge),2);et(He),a(Ge),a(te);var Je=o(te,2),Ke=r(Je),yt=o(Ke,2);a(Je),a(ee);var ne=o(ee,2),ve=r(ne),Ve=r(ve),ht=r(Ve);a(Ve),a(ve);var wt=o(ve,2);{var kt=e=>{var i=Xt();u(e,i)},At=e=>{var i=Gt(),d=Ht(i);{var n=g=>{var f=Yt();u(g,f)},v=g=>{var f=sa();ge(f,5,()=>t(R),xe,(z,m)=>{var N=oa();const E=Vt(()=>ct(t(m).type));var L=r(N),j=r(L),q=r(j),ce=r(q,!0);a(q);var k=o(q,2),S=r(k),A=r(S),ue=r(A,!0);a(A);var G=o(A,2);{var St=l=>{var c=Zt();u(l,c)};T(G,l=>{t(m).read_at||l(St)})}a(S);var fe=o(S,2),Ft=r(fe,!0);a(fe);var Qe=o(fe,2),me=r(Qe),$t=r(me,!0);a(me);var Xe=o(me,2);{var Dt=l=>{var c=ea(),pe=r(c);a(c),x(()=>p(pe,`• To: ${t(m).visible_to_user.name??""}`)),u(l,c)},Et=l=>{var c=ta();u(l,c)};T(Xe,l=>{t(m).visible_to_user?l(Dt):l(Et,!1)})}var qt=o(Xe,2);{var Rt=l=>{var c=aa(),pe=r(c);a(c),x(Ot=>p(pe,`• Read ${Ot??""}`),[()=>ke(t(m).read_at)]),u(l,c)};T(qt,l=>{t(m).read_at&&l(Rt)})}a(Qe),a(k),a(j);var Ye=o(j,2),Ze=r(Ye);{var It=l=>{var c=ra();C("click",c,()=>lt(t(m))),u(l,c)},Ut=l=>{var c=ia();C("click",c,()=>st(t(m))),u(l,c)};T(Ze,l=>{t(m).read_at?l(It):l(Ut,!1)})}var jt=o(Ze,2);a(Ye),a(L),a(N),x(l=>{tt(N,1,`p-6 hover:bg-gray-50 ${t(m).read_at?"":"bg-blue-50 border-l-4 border-blue-400"}`),p(ce,t(E).icon),tt(A,1,`inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-${t(E).color??""}-100 text-${t(E).color??""}-800`),p(ue,t(E).label),p(Ft,t(m).message),p($t,l)},[()=>ke(t(m).created_at)]),C("click",jt,()=>dt(t(m))),u(z,N)}),a(f),u(g,f)};T(d,g=>{t(R).length===0?g(n):g(v,!1)},!0)}u(e,i)};T(wt,e=>{t(F)?e(kt):e(At,!1)})}a(ne);var We=o(ne,2);{var Ct=e=>{var i=da(),d=r(i),n=r(d),v=o(r(n),2),g=r(v),f=o(r(g),2);x(()=>{t(_),be(()=>{})}),ge(f,5,()=>B,xe,(k,S)=>{var A=la(),ue=r(A);a(A);var G={};x(()=>{p(ue,`${t(S).icon??""} ${t(S).label??""}`),G!==(G=t(S).value)&&(A.value=(A.__value=t(S).value)??"")}),u(k,A)}),a(f),a(g);var z=o(g,2),m=o(r(z),2);Jt(m),a(z);var N=o(z,2),E=o(r(N),2);et(E),Kt(2),a(N);var L=o(N,2),j=r(L),q=o(j,2),ce=r(q,!0);a(q),a(L),a(v),a(n),a(d),a(i),x(()=>{q.disabled=t(F),p(ce,t(F)?"Creating...":"Create")}),he(f,()=>t(_).type,k=>_e(_,t(_).type=k)),ye(m,()=>t(_).message,k=>_e(_,t(_).message=k)),ye(E,()=>t(_).visible_to,k=>_e(_,t(_).visible_to=k)),C("click",j,we),C("submit",v,Wt(ot)),u(e,i)};T(We,e=>{t(H)&&e(Ct)})}var Pe=o(We,2);{var Mt=e=>{var i=na(),d=r(i,!0);a(i),x(()=>p(d,t(w))),u(e,i)};T(Pe,e=>{t(w)&&e(Mt)})}var Tt=o(Pe,2);{var Nt=e=>{var i=va(),d=r(i,!0);a(i),x(()=>p(d,t($))),u(e,i)};T(Tt,e=>{t($)&&e(Nt)})}a(Ae),a(W),x(e=>{p(pt,t(J)),p(bt,t(K)),p(_t,t(J)-t(K)),p(gt,e),p(ht,`Notifications (${t(R).length??""})`)},[()=>Object.keys(t(V)).length>0?Object.entries(t(V)).sort(([,e],[,i])=>i-e)[0][0]:"None"]),C("click",Te,nt),C("click",Ne,vt),C("click",mt,it),he(re,()=>t(I),e=>s(I,e)),he(se,()=>t(U),e=>s(U,e)),ye(He,()=>t(O),e=>s(O,e)),C("click",Ke,ut),C("click",yt,ft),u(at,W),Bt()}export{Ca as component};
