import"../chunks/DsnmJJEf.js";import"../chunks/69_IOA4Y.js";import{o as Le}from"../chunks/Y1pQyyvi.js";import{l as wt,q as Pt,r as Dt,m as v,J as kt,x as h,n as m,o as Ut,w as s,v as a,a as e,y as c,s as o,$ as Ft,z as i,E as w,t as k,A as Ot,B as ue,u as fe,K as je}from"../chunks/Ck91ypkQ.js";import{i as $}from"../chunks/RujGBxXx.js";import{e as At,i as Mt}from"../chunks/D775oJua.js";import{r as x,a as Bt}from"../chunks/DvH4tfbe.js";import{s as St}from"../chunks/B38bOHRo.js";import{a as g,c as It}from"../chunks/C4HntxLm.js";import{b as $t}from"../chunks/xkiwYR4x.js";import{p as Et}from"../chunks/D4Caz1gY.js";import{i as Tt}from"../chunks/6tn_K0LM.js";import{s as Rt,a as qt}from"../chunks/DcXenzi0.js";import{p as zt}from"../chunks/CfuI28ud.js";import{g as K}from"../chunks/Bc_wzfnz.js";import{s as E}from"../chunks/CIOq__Tp.js";var Ct=v('<div class="bg-white rounded-xl shadow-sm p-8 text-center"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"></div> <p class="text-gray-600 mt-4">Loading offer data...</p></div>'),Gt=v("<option> </option>"),Vt=v('<div class="relative"><img alt="Offer preview" class="w-full h-48 object-cover rounded-lg border"/> <button type="button" class="absolute top-2 right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 transition-colors">âœ•</button></div>'),Jt=v('<div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-gray-400 transition-colors"><div class="text-gray-400 mb-2">ğŸ“·</div> <p class="text-sm text-gray-600 mb-4">Upload an image for your offer</p></div>'),Nt=v('<div class="border rounded-lg p-4 bg-gray-50"><div class="flex items-center space-x-3"><span class="text-red-600 text-2xl">ğŸ“„</span> <div class="flex-1"><p class="text-sm font-medium text-gray-900"> </p> <p class="text-xs text-gray-500">PDF Document</p></div> <button type="button" class="text-red-500 hover:text-red-700 transition-colors">âœ•</button></div></div>'),Lt=v('<div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-gray-400 transition-colors"><div class="text-gray-400 mb-2">ğŸ“„</div> <p class="text-sm text-gray-600 mb-4">Upload a PDF with offer details</p></div>'),jt=v('<div class="animate-spin rounded-full h-4 w-4 border-b-2 border-white"></div> <span>Updating...</span>',1),Kt=v("<span>Update Offer</span>"),Wt=v('<form class="space-y-8"><div class="bg-white rounded-xl shadow-sm p-6"><h2 class="text-xl font-semibold text-gray-900 mb-6 flex items-center"><span class="text-blue-600 mr-2">ğŸ“</span> Basic Information</h2> <div class="grid grid-cols-1 md:grid-cols-2 gap-6"><div><label for="title" class="block text-sm font-medium text-gray-700 mb-2">Offer Title *</label> <input type="text" id="title" required placeholder="e.g., Summer Sale - 25% Off" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"/></div> <div><label for="branch" class="block text-sm font-medium text-gray-700 mb-2">Target Branch</label> <select id="branch" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"><option>All Branches</option><!></select></div></div> <div class="mt-6"><label for="description" class="block text-sm font-medium text-gray-700 mb-2">Description</label> <textarea id="description" rows="3" placeholder="Describe the offer details..." class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea></div></div> <div class="bg-white rounded-xl shadow-sm p-6"><h2 class="text-xl font-semibold text-gray-900 mb-6 flex items-center"><span class="text-green-600 mr-2">ğŸ’°</span> Discount Settings</h2> <div class="grid grid-cols-1 md:grid-cols-3 gap-6"><div><label for="discountPercentage" class="block text-sm font-medium text-gray-700 mb-2">Discount Percentage</label> <div class="relative"><input type="number" id="discountPercentage" min="0" max="100" step="0.01" placeholder="25" class="w-full px-4 py-3 pr-8 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"/> <span class="absolute right-3 top-3 text-gray-500">%</span></div></div> <div><label for="discountAmount" class="block text-sm font-medium text-gray-700 mb-2">Fixed Discount Amount</label> <div class="relative"><input type="number" id="discountAmount" min="0" step="0.01" placeholder="50" class="w-full px-4 py-3 pr-12 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"/> <span class="absolute right-3 top-3 text-gray-500">SAR</span></div></div> <div><label for="minimumPurchase" class="block text-sm font-medium text-gray-700 mb-2">Minimum Purchase</label> <div class="relative"><input type="number" id="minimumPurchase" min="0" step="0.01" placeholder="100" class="w-full px-4 py-3 pr-12 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"/> <span class="absolute right-3 top-3 text-gray-500">SAR</span></div></div></div></div> <div class="bg-white rounded-xl shadow-sm p-6"><h2 class="text-xl font-semibold text-gray-900 mb-6 flex items-center"><span class="text-purple-600 mr-2">ğŸ“…</span> Validity Period</h2> <div class="grid grid-cols-1 md:grid-cols-2 gap-6"><div><label for="validFrom" class="block text-sm font-medium text-gray-700 mb-2">Valid From</label> <input type="date" id="validFrom" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"/></div> <div><label for="validUntil" class="block text-sm font-medium text-gray-700 mb-2">Valid Until *</label> <input type="date" id="validUntil" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"/></div></div></div> <div class="bg-white rounded-xl shadow-sm p-6"><h2 class="text-xl font-semibold text-gray-900 mb-6 flex items-center"><span class="text-orange-600 mr-2">ğŸ“</span> Visual Content</h2> <div class="grid grid-cols-1 md:grid-cols-2 gap-8"><div><label class="block text-sm font-medium text-gray-700 mb-3">Offer Image (PNG, JPG - Max 5MB)</label> <!> <input type="file" accept="image/*" class="mt-3 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"/></div> <div><label class="block text-sm font-medium text-gray-700 mb-3">Offer Details PDF (Max 10MB)</label> <!> <input type="file" accept=".pdf" class="mt-3 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"/></div></div></div> <div class="bg-white rounded-xl shadow-sm p-6"><h2 class="text-xl font-semibold text-gray-900 mb-6 flex items-center"><span class="text-gray-600 mr-2">âš™ï¸</span> Additional Settings</h2> <div class="space-y-6"><div><label for="maxRedemptions" class="block text-sm font-medium text-gray-700 mb-2">Maximum Redemptions (Optional)</label> <input type="number" id="maxRedemptions" min="0" placeholder="Leave empty for unlimited" class="w-full md:w-64 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"/></div> <div><label for="termsConditions" class="block text-sm font-medium text-gray-700 mb-2">Terms & Conditions</label> <textarea id="termsConditions" rows="4" placeholder="Enter terms and conditions for this offer..." class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea></div> <div class="flex items-center"><input type="checkbox" id="isActive" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2"/> <label for="isActive" class="ml-2 text-sm font-medium text-gray-700">Offer is active and visible to customers</label></div></div></div> <div class="flex items-center justify-between pt-6"><button type="button" class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">Cancel</button> <button type="submit" class="px-8 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 transition-colors flex items-center space-x-2"><!></button></div></form>'),Ht=v('<div class="fixed top-4 right-4 z-50 max-w-sm"><div> </div></div>'),Qt=v('<div class="min-h-screen bg-gray-50 py-8"><div class="max-w-4xl mx-auto px-4"><div class="mb-8"><div class="flex items-center space-x-4"><button class="text-gray-600 hover:text-gray-800 transition-colors">â† Back to Offers Management</button></div> <h1 class="text-3xl font-bold text-gray-900 mt-4">Edit Offer</h1> <p class="text-gray-600 mt-2">Update the offer details and settings</p></div> <!> <!></div></div>');function mr(Ke,We){wt(We,!1);const[He,Qe]=Rt(),me=()=>qt(zt,"$page",He),P=c();let U=c(""),T=c(""),F=c(""),R=c(0),q=c(0),z=c(0),D=c(""),_=c(""),C=c(""),G=c(0),V=c(!0),O=null,J=null,A=c(""),M=c(""),B="",S="",W=c([]),H=c(!1),N=c(!1),L=c(""),ve=c("success");Le(async()=>{e(P)?await Promise.all([Xe(),Ye()]):K("/admin/offers-management")});async function Xe(){try{const{data:t,error:d}=await E.from("branches").select("*").eq("is_active",!0).order("created_at");if(d)throw d;o(W,(t||[]).map(l=>{const u=l.branch_name||l.name||l.title||`Branch ${l.id?.slice(0,8)}`;return{branch_id:l.id,branch_name:u}}))}catch(t){console.error("Error loading branches:",t),p("Failed to load branches","error")}}async function Ye(){try{o(H,!0);const{data:t,error:d}=await E.from("offers").select("*").eq("id",e(P)).single();if(d)throw d;t&&(o(U,t.title||""),o(T,t.description||""),o(F,t.branch_id||""),o(R,t.discount_percentage||0),o(q,t.discount_amount||0),o(z,t.minimum_purchase||0),o(D,t.valid_from||""),o(_,t.valid_until||""),o(C,t.terms_conditions||""),o(G,t.max_redemptions||0),o(V,t.is_active??!0),B=t.image_url||"",S=t.pdf_url||"",B&&o(A,B),S&&o(M,S))}catch(t){console.error("Error loading offer:",t),p("Failed to load offer data","error")}finally{o(H,!1)}}function Ze(t){const l=t.target.files?.[0];if(l){if(!l.type.startsWith("image/")){p("Please select a valid image file (PNG, JPG, JPEG)","error");return}if(l.size>5*1024*1024){p("Image file size must be less than 5MB","error");return}O=l;const u=new FileReader;u.onload=b=>{o(A,b.target?.result)},u.readAsDataURL(l)}}function et(t){const l=t.target.files?.[0];if(l){if(l.type!=="application/pdf"){p("Please select a valid PDF file","error");return}if(l.size>10*1024*1024){p("PDF file size must be less than 10MB","error");return}J=l,o(M,l.name)}}function tt(){O=null,o(A,""),B=""}function rt(){J=null,o(M,""),S=""}async function pe(t,d,l){try{const{data:u,error:b}=await E.storage.from(d).upload(l,t,{upsert:!0});if(b)throw b;const{data:j}=E.storage.from(d).getPublicUrl(l);return j.publicUrl}catch(u){return console.error(`Error uploading ${d}:`,u),null}}async function at(){if(!e(U)||!e(_)){p("Title and Valid Until date are required","error");return}try{o(N,!0);let t=B,d=S;if(O){const u=`offer-${e(P)}-${Date.now()}.${O.name.split(".").pop()}`;t=await pe(O,"offer-images",u)}if(J){const u=`offer-${e(P)}-${Date.now()}.pdf`;d=await pe(J,"offer-pdfs",u)}const{error:l}=await E.from("offers").update({title:e(U),description:e(T),branch_id:e(F)||null,discount_percentage:e(R),discount_amount:e(q),minimum_purchase:e(z),valid_from:e(D),valid_until:e(_),image_url:t,pdf_url:d,terms_conditions:e(C),max_redemptions:e(G)||null,is_active:e(V),updated_at:new Date().toISOString()}).eq("id",e(P));if(l)throw l;p("Offer updated successfully!","success"),setTimeout(()=>{K("/admin/offers-management")},1500)}catch(t){console.error("Error updating offer:",t),p("Failed to update offer. Please try again.","error")}finally{o(N,!1)}}function p(t,d){o(L,t),o(ve,d),setTimeout(()=>{o(L,"")},5e3)}function it(){if(e(D)||o(D,new Date().toISOString().split("T")[0]),!e(_)){const t=new Date;t.setMonth(t.getMonth()+1),o(_,t.toISOString().split("T")[0])}}Le(()=>{it()}),Pt(()=>me(),()=>{o(P,me().params.id)}),Dt(),Tt();var Q=Qt();kt(t=>{Ft.title="Edit Offer - Admin Panel"});var ge=a(Q),X=a(ge),be=a(X),st=a(be);i(be),w(4),i(X);var xe=s(X,2);{var ot=t=>{var d=Ct();m(t,d)},lt=t=>{var d=Wt(),l=a(d),u=s(a(l),2),b=a(u),j=s(a(b),2);x(j),i(b);var _e=s(b,2),Y=s(a(_e),2);k(()=>{e(F),Ot(()=>{e(W)})});var Z=a(Y);Z.value=Z.__value="";var ct=s(Z);At(ct,1,()=>e(W),Mt,(r,n)=>{var f=Gt(),y=a(f,!0);i(f);var I={};k(()=>{ue(y,(e(n),fe(()=>e(n).branch_name))),I!==(I=(e(n),fe(()=>e(n).branch_id)))&&(f.value=(f.__value=(e(n),fe(()=>e(n).branch_id)))??"")}),m(r,f)}),i(Y),i(_e),i(u);var ye=s(u,2),he=s(a(ye),2);je(he),i(ye),i(l);var ee=s(l,2),we=s(a(ee),2),te=a(we),Pe=s(a(te),2),De=a(Pe);x(De),w(2),i(Pe),i(te);var re=s(te,2),ke=s(a(re),2),Ue=a(ke);x(Ue),w(2),i(ke),i(re);var Fe=s(re,2),Oe=s(a(Fe),2),Ae=a(Oe);x(Ae),w(2),i(Oe),i(Fe),i(we),i(ee);var ae=s(ee,2),Me=s(a(ae),2),ie=a(Me),Be=s(a(ie),2);x(Be),i(ie);var Se=s(ie,2),Ie=s(a(Se),2);x(Ie),i(Se),i(Me),i(ae);var se=s(ae,2),$e=s(a(se),2),oe=a($e),Ee=s(a(oe),2);{var ut=r=>{var n=Vt(),f=a(n),y=s(f,2);i(n),k(()=>Bt(f,"src",e(A))),h("click",y,tt),m(r,n)},ft=r=>{var n=Jt();m(r,n)};$(Ee,r=>{e(A)?r(ut):r(ft,!1)})}var mt=s(Ee,2);i(oe);var Te=s(oe,2),Re=s(a(Te),2);{var vt=r=>{var n=Nt(),f=a(n),y=s(a(f),2),I=a(y),yt=a(I,!0);i(I),w(2),i(y);var ht=s(y,2);i(f),i(n),k(()=>ue(yt,e(M))),h("click",ht,rt),m(r,n)},pt=r=>{var n=Lt();m(r,n)};$(Re,r=>{e(M)?r(vt):r(pt,!1)})}var gt=s(Re,2);i(Te),i($e),i(se);var le=s(se,2),qe=s(a(le),2),de=a(qe),ze=s(a(de),2);x(ze),i(de);var ne=s(de,2),Ce=s(a(ne),2);je(Ce),i(ne);var Ge=s(ne,2),Ve=a(Ge);x(Ve),w(2),i(Ge),i(qe),i(le);var Je=s(le,2),Ne=a(Je),ce=s(Ne,2),bt=a(ce);{var xt=r=>{var n=jt();w(2),m(r,n)},_t=r=>{var n=Kt();m(r,n)};$(bt,r=>{e(N)?r(xt):r(_t,!1)})}i(ce),i(Je),i(d),k(()=>ce.disabled=e(N)),g(j,()=>e(U),r=>o(U,r)),$t(Y,()=>e(F),r=>o(F,r)),g(he,()=>e(T),r=>o(T,r)),g(De,()=>e(R),r=>o(R,r)),g(Ue,()=>e(q),r=>o(q,r)),g(Ae,()=>e(z),r=>o(z,r)),g(Be,()=>e(D),r=>o(D,r)),g(Ie,()=>e(_),r=>o(_,r)),h("change",mt,Ze),h("change",gt,et),g(ze,()=>e(G),r=>o(G,r)),g(Ce,()=>e(C),r=>o(C,r)),It(Ve,()=>e(V),r=>o(V,r)),h("click",Ne,()=>K("/admin/offers-management")),h("submit",d,Et(at)),m(t,d)};$(xe,t=>{e(H)?t(ot):t(lt,!1)})}var dt=s(xe,2);{var nt=t=>{var d=Ht(),l=a(d),u=a(l,!0);i(l),i(d),k(()=>{St(l,1,`rounded-lg p-4 shadow-lg ${e(ve)==="success"?"bg-green-500":"bg-red-500"} text-white`),ue(u,e(L))}),m(t,d)};$(dt,t=>{e(L)&&t(nt)})}i(ge),i(Q),h("click",st,()=>K("/admin/offers-management")),m(Ke,Q),Ut(),Qe()}export{mr as component};
